<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISPRO - PMAM | Sistema de Procedimentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        // CONFIGURAÇÃO DO BANCO DE DADOS (COLE AQUI SEUS DADOS)
        const SUPABASE_URL = 'https://dzknjtstiptcbkvszibo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6a25qdHN0aXB0Y2JrdnN6aWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTU3NDYsImV4cCI6MjA4MTQ3MTc0Nn0.LN4j37EHqLQpdoS0mNAIW9v-MTgWo8nXoFl1FrhSSHE';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pmam-navy': '#0a0c10',
                        'pmam-gold': '#D4AF37',
                        'pmam-gold-dark': '#B8941F'
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #F4D03F 100%); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="w-full py-8 flex flex-col items-center justify-center border-b border-white/10 glass">
        <img src="logo-sispro.png" alt="SISPRO PMAM" class="h-32 w-auto mb-4 drop-shadow-[0_0_15px_rgba(212,175,55,0.3)]">
        <h1 class="text-3xl font-bold tracking-[0.2em] text-pmam-gold">SISPRO</h1>
        <p class="text-xs text-gray-400 mt-1 uppercase tracking-widest">Procedimentos Policiais Militares - AM</p>
    </header>

    <main class="flex-grow container mx-auto px-4 py-10 max-w-4xl">
        <div class="glass p-8 rounded-2xl shadow-2xl">
            <h2 class="text-xl font-semibold mb-6 flex items-center gap-3">
                <i class="fas fa-file-signature text-pmam-gold"></i> Novo Procedimento
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Tipo de Documento</label>
                    <select id="tipo" class="w-full bg-pmam-navy border border-white/20 rounded-lg p-3 text-white focus:border-pmam-gold outline-none transition-all">
                        <option value="IPM">IPM - Inquérito Policial Militar</option>
                        <option value="FATD">FATD - Formulário de Transgressão</option>
                        <option value="Sindicância">Sindicância</option>
                        <option value="ISO">ISO</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Número do Procedimento</label>
                    <input type="text" id="numero" placeholder="Ex: 001/2023-Correg" class="w-full bg-pmam-navy border border-white/20 rounded-lg p-3 text-white focus:border-pmam-gold outline-none transition-all">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-400 mb-2">Conteúdo do Relatório</label>
                    <textarea id="conteudo" rows="6" class="w-full bg-pmam-navy border border-white/20 rounded-lg p-3 text-white focus:border-pmam-gold outline-none transition-all"></textarea>
                </div>
            </div>

            <button onclick="salvar()" id="btn-salvar" class="mt-8 w-full gold-gradient text-black font-bold py-4 rounded-lg hover:brightness-110 transition-all flex items-center justify-center gap-2 shadow-lg shadow-pmam-gold/20">
                <i class="fas fa-save"></i> SALVAR NO BANCO DE DADOS
            </button>
        </div>

        <div class="mt-12 glass p-8 rounded-2xl">
            <h2 class="text-xl font-semibold mb-6 flex items-center gap-3">
                <i class="fas fa-database text-pmam-gold"></i> Procedimentos na Nuvem
            </h2>
            <div id="lista-procedimentos" class="space-y-4 text-sm">
                <p class="text-gray-500 italic">Carregando dados...</p>
            </div>
        </div>
    </main>

    <script>
        // FUNÇÃO PARA SALVAR NO SUPABASE
        async function salvar() {
            const btn = document.getElementById('btn-salvar');
            const dados = {
                tipo_documento: document.getElementById('tipo').value,
                numero_procedimento: document.getElementById('numero').value,
                conteudo: { texto: document.getElementById('conteudo').value }
            };

            if(!dados.numero_procedimento) return alert("Preencha o número do procedimento!");

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner animate-spin"></i> SALVANDO...';

            const { data, error } = await supabaseClient
                .from('procedimentos')
                .insert([dados]);

            if (error) {
                console.error(error);
                alert("Erro ao salvar: " + error.message);
            } else {
                alert("Sucesso! Procedimento arquivado na nuvem.");
                document.getElementById('numero').value = '';
                document.getElementById('conteudo').value = '';
                carregarDados();
            }
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-save"></i> SALVAR NO BANCO DE DADOS';
        }

        // FUNÇÃO PARA CARREGAR DO SUPABASE
        async function carregarDados() {
            const container = document.getElementById('lista-procedimentos');
            const { data, error } = await supabaseClient
                .from('procedimentos')
                .select('*')
                .order('data_criacao', { ascending: false });

            if (error) {
                container.innerHTML = "Erro ao carregar dados.";
                return;
            }

            if (data.length === 0) {
                container.innerHTML = "Nenhum registro encontrado.";
                return;
            }

            container.innerHTML = data.map(item => `
                <div class="p-4 bg-white/5 border-l-4 border-pmam-gold rounded flex justify-between items-center">
                    <div>
                        <span class="font-bold text-pmam-gold">${item.tipo_documento}</span>
                        <span class="ml-2 text-gray-300">${item.numero_procedimento}</span>
                    </div>
                    <span class="text-[10px] text-gray-500">${new Date(item.data_criacao).toLocaleDateString()}</span>
                </div>
            `).join('');
        }

        // Iniciar
        carregarDados();
    </script>
</body>
</html>
