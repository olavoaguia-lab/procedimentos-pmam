<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMAM - Sistema de Procedimentos Oficiais</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos CSS (Melhorados para Estética Moderna) */
        :root {
            --pm-azul-marinho: #1e3a8a; /* Base primária */
            --pm-azul-claro: #3b82f6;
            --pm-destaque: #0ea5e9; /* Cor de destaque */
            --pm-verde: #10b981; /* Sucesso */
            --pm-vermelho: #ef4444; /* Erro */
            --pm-cinza: #64748b;
            --pm-fundo: #f8fafc; /* Fundo mais claro */
            --pm-cartao: #ffffff; /* Fundo do cartão */
            --pm-sombra: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --pm-raio: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--pm-fundo);
            color: #1f2937;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        /* ------------------ Sidebar (Menu Lateral) ------------------ */
        .sidebar {
            width: 250px;
            background-color: var(--pm-azul-marinho);
            color: var(--pm-cartao);
            padding: 20px 0;
            box-shadow: var(--pm-sombra);
            z-index: 10;
            flex-shrink: 0;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
            font-weight: 600;
        }

        .sidebar-item {
            display: block;
            padding: 15px 20px;
            margin: 5px 10px;
            border-radius: var(--pm-raio);
            text-decoration: none;
            color: var(--pm-cartao);
            transition: background-color 0.2s, color 0.2s;
            font-size: 0.95rem;
        }

        .sidebar-item:hover, .sidebar-item.ativo {
            background-color: var(--pm-destaque);
            color: var(--pm-azul-marinho);
        }

        .sidebar-item i {
            margin-right: 10px;
        }

        /* ------------------ Conteúdo Principal ------------------ */
        .main-content {
            flex-grow: 1;
            padding: 40px;
        }

        .card {
            background-color: var(--pm-cartao);
            padding: 30px;
            border-radius: var(--pm-raio);
            box-shadow: var(--pm-sombra);
        }

        .card h1 {
            color: var(--pm-azul-marinho);
            margin-bottom: 20px;
            font-size: 2rem;
            border-bottom: 2px solid var(--pm-destaque);
            padding-bottom: 10px;
        }

        /* ------------------ Formulário ------------------ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--pm-cinza);
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--pm-destaque);
            outline: none;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }

        /* ------------------ Botões ------------------ */
        .botoes-acao {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.1s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primario {
            background-color: var(--pm-azul-claro);
            color: var(--pm-cartao);
        }

        .btn-primario:hover {
            background-color: var(--pm-destaque);
            box-shadow: 0 5px 10px rgba(14, 165, 233, 0.4);
            transform: translateY(-2px);
        }

        .btn-secundario {
            background-color: var(--pm-cinza);
            color: var(--pm-cartao);
        }

        .btn-secundario:hover {
            background-color: #4b5563;
            box-shadow: 0 5px 10px rgba(100, 116, 139, 0.4);
            transform: translateY(-2px);
        }

        /* ------------------ Toast (Notificações) ------------------ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .toast {
            min-width: 250px;
            padding: 15px 20px;
            border-radius: var(--pm-raio);
            box-shadow: var(--pm-sombra);
            margin-bottom: 10px;
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
        }

        .toast.mostrar {
            opacity: 1;
            transform: translateX(0);
        }

        .toast i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .toast-sucesso { background-color: var(--pm-verde); color: var(--pm-cartao); }
        .toast-erro { background-color: var(--pm-vermelho); color: var(--pm-cartao); }
        .toast-info { background-color: var(--pm-azul-marinho); color: var(--pm-cartao); }
        
        /* ------------------ Preview PDF (Área de Modelo) ------------------ */
        #preview-documento {
            border: 1px solid #e2e8f0;
            padding: 20px;
            min-height: 200px;
            background-color: #fff;
            margin-top: 20px;
            white-space: pre-wrap; /* Preserva espaços e quebras de linha */
            font-family: monospace;
            font-size: 0.9rem;
            color: #333;
        }

    </style>
</head>
<body>

    <div class="sidebar">
        <h2><i class="fas fa-gavel"></i> PMAM SJD</h2>
        <a href="#" class="sidebar-item ativo" onclick="sistema.carregarModelo('sindicancia')"><i class="fas fa-file-alt"></i> Sindicância (Completa)</a>
        <a href="#" class="sidebar-item" onclick="sistema.carregarModelo('portaria')"><i class="fas fa-scroll"></i> Portaria</a>
        <a href="#" class="sidebar-item" onclick="sistema.carregarModelo('encaminhamento')"><i class="fas fa-share-square"></i> Ofício de Encaminhamento</a>
        <a href="#" class="sidebar-item" onclick="sistema.carregarModelo('defesa')"><i class="fas fa-book"></i> Termo de Defesa</a>
    </div>

    <div class="main-content">
        <div class="card">
            <h1 id="titulo-documento"><i class="fas fa-file-invoice"></i> Gerador de Sindicância PMAM</h1>
            <p>Preencha os campos abaixo para gerar o documento oficial.</p>
            
            <form id="form-documento">
                <div id="campos-dinamicos">
                    <div class="form-group">
                        <label for="tipo_procedimento">Tipo de Procedimento:</label>
                        <select id="tipo_procedimento" name="tipo_procedimento">
                            <option value="Sindicância">Sindicância</option>
                            <option value="IPM">Inquérito Policial Militar</option>
                            <option value="PA">Processo Administrativo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numero_portaria">Nº da Portaria:</label>
                        <input type="text" id="numero_portaria" name="numero_portaria" placeholder="Ex: 05.02/2023/IPM/SJD/CPA OESTE/PMAM">
                    </div>
                    <div class="form-group">
                        <label for="inquirido_nome">Nome/CI do Inquirido:</label>
                        <input type="text" id="inquirido_nome" name="inquirido_nome" placeholder="Ex: CAP QOPM Stanley Oliveira De Araújo (CI 20943)">
                    </div>
                    <div class="form-group">
                        <label for="objeto_apuracao">Objeto da Apuração (Resumo):</label>
                        <textarea id="objeto_apuracao" name="objeto_apuracao" rows="3" placeholder="Ex: Apurar a suposta irregularidade praticada pelo Inquirido conforme Queixa Crime anexa..."></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pré-visualização do Documento:</label>
                    <div id="preview-documento">
                        ... O documento será renderizado aqui ...
                    </div>
                </div>

                <div class="botoes-acao">
                    <button type="button" class="btn btn-primario" onclick="sistema.gerarPDF()"><i class="fas fa-file-pdf"></i> Gerar PDF</button>
                    <button type="button" class="btn btn-secundario" onclick="sistema.copiarTexto()"><i class="fas fa-copy"></i> Copiar Texto</button>
                </div>
            </form>
        </div>
    </div>

    <div class="toast-container" id="toast-container">
        </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // JS - Lógica, Funcionalidade e Modelos (Mais detalhes abaixo)
        const { jsPDF } = window.jspdf;

        class SistemaPMAM {
            constructor() {
                this.modelos = this.definirModelos();
                this.camposContainer = document.getElementById('campos-dinamicos');
                this.previewArea = document.getElementById('preview-documento');
                this.form = document.getElementById('form-documento');
                this.tituloDocumento = document.getElementById('titulo-documento');

                // Listener para atualizar a pré-visualização em tempo real
                this.form.addEventListener('input', () => this.atualizarPreview());
                
                // Carrega o modelo inicial
                this.modeloAtualId = 'sindicancia';
                this.carregarModelo(this.modeloAtualId);
            }

            // 1. DEFINE OS MODELOS DE DOCUMENTOS (Simples para a demonstração)
            definirModelos() {
                return {
                    sindicancia: {
                        titulo: "Sindicância (Termo de Abertura)",
                        campos: [
                            { id: 'numero_portaria', label: 'Nº da Portaria', tipo: 'text', placeholder: 'Ex: 05.02/2023/IPM/SJD/CPA OESTE/PMAM', valorPadrao: 'XX.XX/AAAA/SIND/PMAM' },
                            { id: 'inquirido_nome', label: 'Nome/CI do Inquirido', tipo: 'text', placeholder: 'Ex: CAP QOPM Stanley Oliveira De Araújo (CI 20943)', valorPadrao: 'Nome do Militar (CI XXXX)' },
                            { id: 'encarregado_nome', label: 'Nome do Encarregado', tipo: 'text', placeholder: 'Ex: MAJ QOPM Olavo Pereira Da Silva Filho', valorPadrao: 'MAJ QOPM FULANO DA SILVA (CI XXXX)' },
                            { id: 'objeto_apuracao', label: 'Objeto da Apuração (Resumo)', tipo: 'textarea', placeholder: 'Ex: Apurar a suposta irregularidade...', valorPadrao: 'APURAR AS SUPOSTA IRREGULARIDADE PRATICADA PELO INQUIRIDO...' },
                        ],
                        template: (dados) => `
                            AUTOS DE SINDICÂNCIA
                            
                            INQUIRIDO: ${dados.inquirido_nome || ''}
                            OBJETO: ${dados.objeto_apuracao || ''}
                            
                            TERMO DE ABERTURA
                            
                            Aos [Dia] dias do mês de [Mês] de [Ano], nesta Cidade de Manaus, Estado do Amazonas, na sala da SJD do Batalhão Oeste, autuo a Portaria nº ${dados.numero_portaria || '__________'}, de [Data], e demais documentos que a este junto, do que para constar lavro o presente termo.
                            
                            Quartel em Manaus-AM, [Dia] de [Mês] de [Ano].
                            
                            ${dados.encarregado_nome || '__________________________________'}
                            Encarregado da Sindicância
                        `
                    },
                    portaria: {
                        titulo: "Portaria de Instauração",
                        campos: [
                            { id: 'cmt_nome', label: 'Nome do Comandante', tipo: 'text', valorPadrao: 'TC QOPM MARIVALDO DE SOUZA FRANÇA FILHO' },
                            { id: 'cmt_cargo', label: 'Cargo do Comandante', tipo: 'text', valorPadrao: 'COMANDANTE DO BATALHÃO OESTE' },
                            { id: 'documento_origem', label: 'Documento de Origem', tipo: 'text', valorPadrao: 'Queixa Crime anexa' },
                        ],
                        template: (dados) => `
                            PORTARIA Nº XX.XX/AAAA/SJD/PMAM
                            
                            O ${dados.cmt_cargo || ''}, no uso de suas atribuições legais, e em cumprimento ao previsto na legislação em vigor,
                            
                            CONSIDERANDO o teor do ${dados.documento_origem || ''};
                            
                            RESOLVE:
                            
                            INSTAURAR Sindicância para apurar os fatos mencionados.
                            
                            Manaus-AM, [Dia] de [Mês] de [Ano].
                            
                            ${dados.cmt_nome || '__________________________________'}
                            ${dados.cmt_cargo || ''}
                        `
                    },
                    // ... Outros modelos (encaminhamento, defesa) seriam definidos aqui.
                };
            }

            // 2. CARREGA O MODELO NA INTERFACE
            carregarModelo(modeloId) {
                const modelo = this.modelos[modeloId];
                if (!modelo) {
                    this.mostrarToast('Modelo não encontrado.', 'erro');
                    return;
                }

                this.modeloAtualId = modeloId;
                this.tituloDocumento.innerHTML = `<i class="fas fa-file-invoice"></i> Gerador de ${modelo.titulo}`;
                this.camposContainer.innerHTML = ''; // Limpa campos antigos

                // Cria os campos dinamicamente
                modelo.campos.forEach(campo => {
                    const div = document.createElement('div');
                    div.className = 'form-group';
                    div.innerHTML = `
                        <label for="${campo.id}">${campo.label}:</label>
                        <${campo.tipo === 'textarea' ? 'textarea' : 'input'} 
                            id="${campo.id}" 
                            name="${campo.id}" 
                            ${campo.tipo === 'textarea' ? `rows="3"` : `type="${campo.tipo}"`} 
                            placeholder="${campo.placeholder || ''}"
                        >${campo.tipo === 'textarea' ? campo.valorPadrao || '' : ''}</${campo.tipo === 'textarea' ? 'textarea' : 'input'}>
                    `;
                    // Define valor para inputs
                    if (campo.tipo !== 'textarea') {
                        div.querySelector('input').value = campo.valorPadrao || '';
                    }
                    this.camposContainer.appendChild(div);
                });

                // Remove o estado ativo dos itens do menu e aplica ao novo
                document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('ativo'));
                document.querySelector(`[onclick="sistema.carregarModelo('${modeloId}')"]`).classList.add('ativo');

                this.atualizarPreview(); // Atualiza com os valores padrões
            }

            // 3. OBTÉM OS DADOS DO FORMULÁRIO
            obterDados() {
                const dados = {};
                const formElements = this.form.querySelectorAll('input, textarea, select');
                formElements.forEach(element => {
                    if (element.name) {
                        dados[element.name] = element.value;
                    }
                });
                return dados;
            }

            // 4. ATUALIZA A PRÉ-VISUALIZAÇÃO (em tempo real)
            atualizarPreview() {
                const modelo = this.modelos[this.modeloAtualId];
                if (modelo && modelo.template) {
                    const dados = this.obterDados();
                    this.previewArea.textContent = modelo.template(dados).trim(); // Usa textContent para segurança
                }
            }

            // 5. GERA O PDF USANDO JSDPF
            gerarPDF() {
                const dados = this.obterDados();
                const modelo = this.modelos[this.modeloAtualId];
                
                if (!modelo) {
                    this.mostrarToast('Erro: Modelo de documento não definido.', 'erro');
                    return;
                }

                const nomeArquivo = `${modelo.titulo.replace(/\s/g, '_')}_${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.pdf`;
                const conteudo = modelo.template(dados);

                try {
                    const doc = new jsPDF({
                        unit: 'mm',
                        format: 'a4'
                    });

                    // Configuração de Fonte (importante para caracteres especiais em PT-BR)
                    // Nota: jspdf usa fontes padrão, pode ser necessário incluir mais fontes para full-PT-BR
                    const margem = 20; // Margem de 20mm
                    const larguraConteudo = doc.internal.pageSize.getWidth() - 2 * margem;
                    
                    doc.setFont('helvetica');
                    doc.setFontSize(12);

                    // Adiciona o conteúdo com quebras de linha automáticas
                    const linhas = doc.splitTextToSize(conteudo, larguraConteudo);
                    doc.text(linhas, margem, margem + 10); // +10mm para descer um pouco

                    doc.save(nomeArquivo);
                    this.mostrarToast(`PDF de "${modelo.titulo}" gerado com sucesso!`, 'sucesso');

                } catch (e) {
                    console.error("Erro ao gerar PDF:", e);
                    this.mostrarToast('Erro ao gerar PDF. Verifique o console.', 'erro');
                }
            }
            
            // 6. COPIA O TEXTO
            copiarTexto() {
                const texto = this.previewArea.textContent;
                navigator.clipboard.writeText(texto)
                    .then(() => {
                        this.mostrarToast('Conteúdo do documento copiado para a área de transferência!', 'sucesso');
                    })
                    .catch(err => {
                        console.error('Erro ao copiar texto: ', err);
                        this.mostrarToast('Erro ao copiar texto.', 'erro');
                    });
            }

            // 7. TOASTS (Melhorado do código original)
            mostrarToast(mensagem, tipo = 'info') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${tipo}`;
                
                let iconeClass = '';
                if (tipo === 'sucesso') {
                    iconeClass = 'fas fa-check-circle';
                } else if (tipo === 'erro') {
                    iconeClass = 'fas fa-exclamation-circle';
                } else if (tipo === 'info') {
                    iconeClass = 'fas fa-info-circle';
                }
                
                toast.innerHTML = `<i class="${iconeClass}"></i> <span>${mensagem}</span>`;
                
                container.appendChild(toast);
                
                // Mostrar e Remover
                setTimeout(() => {
                    toast.classList.add('mostrar');
                }, 10); // Pequeno delay para garantir a animação

                setTimeout(() => {
                    toast.classList.remove('mostrar');
                    // Remove o elemento após a transição
                    setTimeout(() => {
                        container.removeChild(toast);
                    }, 300); 
                }, 3000);
            }
        }

        // Inicializar o sistema ao carregar a página
        let sistema;
        document.addEventListener('DOMContentLoaded', () => {
            sistema = new SistemaPMAM();
            window.sistema = sistema; // Torna acessível no escopo global
        });
    </script>
</body>
</html>
