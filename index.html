<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISPRO ADVOCACY | Sistema de Procedimentos PMAM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'adv-dark': '#0f172a',
                        'adv-primary': '#1e40af',
                        'adv-secondary': '#3b82f6',
                        'adv-accent': '#0ea5e9',
                        'adv-success': '#10b981',
                        'adv-warning': '#f59e0b',
                        'adv-error': '#ef4444',
                        'adv-surface': '#f8fafc',
                        'adv-card': '#ffffff',
                        'adv-border': '#e2e8f0',
                        'adv-text': '#334155',
                        'adv-muted': '#64748b',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'slide-in': 'slideIn 0.4s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'pulse-gentle': 'pulseGentle 2s ease-in-out infinite',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(20px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        pulseGentle: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' },
                        },
                    },
                    boxShadow: {
                        'adv-lg': '0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'adv-xl': '0 20px 40px -10px rgba(0, 0, 0, 0.1)',
                        'adv-inner': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.05)',
                    },
                }
            }
        }
    </script>
    
    <style>
        /* Estilos customizados */
        body {
            font-feature-settings: "kern", "liga", "clig", "calt";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Tab Navigation Modern */
        .tab-nav {
            position: relative;
            overflow: visible;
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #0ea5e9);
            border-radius: 3px 3px 0 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
        }
        
        .tab-item {
            position: relative;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .tab-item:hover:not(.active) {
            background-color: rgba(59, 130, 246, 0.05);
            transform: translateY(-1px);
        }
        
        .tab-item.active {
            color: #1e40af;
            font-weight: 600;
        }
        
        .tab-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .tab-item.disabled:hover {
            background-color: transparent;
            transform: none;
        }
        
        /* Card hover effects */
        .card-hover {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        
        /* Input styling */
        .input-adv {
            transition: all 0.2s ease;
        }
        
        .input-adv:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Preview editor */
        .preview-editor {
            font-family: 'Courier New', 'JetBrains Mono', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            tab-size: 2;
        }
        
        .preview-editor:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        /* Glass effect */
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Progress indicator */
        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .progress-dot.active {
            width: 24px;
            border-radius: 4px;
            background: linear-gradient(90deg, #3b82f6, #0ea5e9);
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-adv-surface text-adv-text font-sans min-h-screen">
    
    <!-- Header -->
    <header class="sticky top-0 z-50 glass-effect shadow-adv-lg border-b border-adv-border/50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-adv-primary to-adv-accent flex items-center justify-center">
                        <i class="fas fa-balance-scale text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-adv-primary to-adv-accent bg-clip-text text-transparent">
                            SISPRO ADVOCACY
                        </h1>
                        <p class="text-sm text-adv-muted">Sistema Corporativo de Procedimentos • PMAM</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-2 text-sm text-adv-muted">
                        <i class="fas fa-user-shield text-adv-secondary"></i>
                        <span>Sessão Segura</span>
                        <div class="w-2 h-2 rounded-full bg-adv-success animate-pulse-gentle"></div>
                    </div>
                    <button id="user-menu" class="w-10 h-10 rounded-full bg-gradient-to-br from-adv-primary/10 to-adv-accent/10 flex items-center justify-center text-adv-primary hover:from-adv-primary/20 hover:to-adv-accent/20 transition-all">
                        <i class="fas fa-user-tie"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Progress Indicator -->
    <div class="sticky top-[73px] z-40 bg-white/80 backdrop-blur-sm border-b border-adv-border/50">
        <div class="container mx-auto px-6 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-3">
                        <div class="progress-dot bg-adv-secondary active"></div>
                        <div class="progress-dot bg-adv-border" id="progress-2"></div>
                        <div class="progress-dot bg-adv-border" id="progress-3"></div>
                        <div class="progress-dot bg-adv-border" id="progress-4"></div>
                    </div>
                    
                    <div class="text-sm text-adv-muted hidden md:block">
                        <span class="font-medium text-adv-primary" id="current-step">Tipo de Procedimento</span>
                        <span class="mx-2">→</span>
                        <span id="total-steps">4 etapas</span>
                    </div>
                </div>
                
                <button id="help-btn" class="text-adv-muted hover:text-adv-primary transition-colors">
                    <i class="fas fa-question-circle"></i>
                    <span class="hidden md:inline ml-2 text-sm">Ajuda</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 md:px-6">
        <!-- Tab Navigation -->
        <div class="tab-nav bg-white rounded-xl shadow-adv-lg mb-8 overflow-hidden">
            <div class="flex overflow-x-auto">
                <div id="tab-indicator" class="tab-indicator" style="width: 140px; left: 16px;"></div>
                
                <div id="tab-procedimento" class="tab-item active flex-1 min-w-[140px] text-center py-4 px-6 font-medium"
                     onclick="sistema.navegarPara('procedimento')"
                     onmouseenter="sistema.hoverTab('procedimento')"
                     data-step="1">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-adv-primary/10 flex items-center justify-center mb-2">
                            <i class="fas fa-folder-open text-adv-primary"></i>
                        </div>
                        <span class="text-sm">Procedimento</span>
                    </div>
                </div>
                
                <div id="tab-caracterizacao" class="tab-item flex-1 min-w-[140px] text-center py-4 px-6 font-medium disabled"
                     onclick="sistema.navegarPara('caracterizacao')"
                     onmouseenter="sistema.hoverTab('caracterizacao')"
                     data-step="2">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-adv-border flex items-center justify-center mb-2">
                            <i class="fas fa-users text-adv-muted"></i>
                        </div>
                        <span class="text-sm text-adv-muted">Caracterização</span>
                    </div>
                </div>
                
                <div id="tab-documentos" class="tab-item flex-1 min-w-[140px] text-center py-4 px-6 font-medium disabled"
                     onclick="sistema.navegarPara('documentos')"
                     onmouseenter="sistema.hoverTab('documentos')"
                     data-step="3">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-adv-border flex items-center justify-center mb-2">
                            <i class="fas fa-file-alt text-adv-muted"></i>
                        </div>
                        <span class="text-sm text-adv-muted">Documentos</span>
                    </div>
                </div>
                
                <div id="tab-preview" class="tab-item flex-1 min-w-[140px] text-center py-4 px-6 font-medium disabled"
                     onclick="sistema.navegarPara('preview')"
                     onmouseenter="sistema.hoverTab('preview')"
                     data-step="4">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-adv-border flex items-center justify-center mb-2">
                            <i class="fas fa-eye text-adv-muted"></i>
                        </div>
                        <span class="text-sm text-adv-muted">Preview</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="min-h-[600px]">
            <!-- Step 1: Tipo de Procedimento -->
            <div id="content-procedimento" class="animate-slide-in">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-adv-dark mb-2">Selecionar Tipo de Procedimento</h2>
                    <p class="text-adv-muted">Escolha o tipo de procedimento jurídico que deseja elaborar</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div onclick="sistema.selecionarProcedimento('SD')" 
                         class="card-hover bg-white rounded-xl border-2 border-adv-border p-6 cursor-pointer hover:border-adv-secondary transition-all group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                <i class="fas fa-gavel text-white text-xl"></i>
                            </div>
                            <span class="text-xs font-semibold bg-blue-50 text-blue-700 px-3 py-1 rounded-full">DISCIPLINAR</span>
                        </div>
                        <h3 class="text-lg font-bold text-adv-dark mb-2 group-hover:text-blue-600">Sindicância Disciplinar</h3>
                        <p class="text-adv-muted text-sm mb-4">Para apuração de infrações disciplinares cometidas por militares</p>
                        <div class="flex items-center text-sm text-blue-600">
                            <span>Iniciar Procedimento</span>
                            <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </div>
                    
                    <div onclick="sistema.selecionarProcedimento('SI')" 
                         class="card-hover bg-white rounded-xl border-2 border-adv-border p-6 cursor-pointer hover:border-adv-secondary transition-all group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                                <i class="fas fa-search text-white text-xl"></i>
                            </div>
                            <span class="text-xs font-semibold bg-purple-50 text-purple-700 px-3 py-1 rounded-full">INVESTIGATIVO</span>
                        </div>
                        <h3 class="text-lg font-bold text-adv-dark mb-2 group-hover:text-purple-600">Sindicância Investigativa</h3>
                        <p class="text-adv-muted text-sm mb-4">Para investigação de fatos que possam configurar infrações</p>
                        <div class="flex items-center text-sm text-purple-600">
                            <span>Iniciar Procedimento</span>
                            <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </div>
                    
                    <div onclick="sistema.selecionarProcedimento('IPM')" 
                         class="card-hover bg-white rounded-xl border-2 border-adv-border p-6 cursor-pointer hover:border-adv-secondary transition-all group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
                                <i class="fas fa-shield-alt text-white text-xl"></i>
                            </div>
                            <span class="text-xs font-semibold bg-red-50 text-red-700 px-3 py-1 rounded-full">PENAL MILITAR</span>
                        </div>
                        <h3 class="text-lg font-bold text-adv-dark mb-2 group-hover:text-red-600">Inquérito Policial Militar</h3>
                        <p class="text-adv-muted text-sm mb-4">Para investigação de infrações penais militares</p>
                        <div class="flex items-center text-sm text-red-600">
                            <span>Iniciar Procedimento</span>
                            <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </div>
                    
                    <div onclick="sistema.selecionarProcedimento('PAD')" 
                         class="card-hover bg-white rounded-xl border-2 border-adv-border p-6 cursor-pointer hover:border-adv-secondary transition-all group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center">
                                <i class="fas fa-scale-balanced text-white text-xl"></i>
                            </div>
                            <span class="text-xs font-semibold bg-amber-50 text-amber-700 px-3 py-1 rounded-full">ADMINISTRATIVO</span>
                        </div>
                        <h3 class="text-lg font-bold text-adv-dark mb-2 group-hover:text-amber-600">Processo Administrativo Disciplinar</h3>
                        <p class="text-adv-muted text-sm mb-4">Processo formal para apuração de infrações disciplinares graves</p>
                        <div class="flex items-center text-sm text-amber-600">
                            <span>Iniciar Procedimento</span>
                            <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </div>
                    
                    <div onclick="sistema.selecionarProcedimento('PARE')" 
                         class="card-hover bg-white rounded-xl border-2 border-adv-border p-6 cursor-pointer hover:border-adv-secondary transition-all group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center">
                                <i class="fas fa-hand-holding-usd text-white text-xl"></i>
                            </div>
                            <span class="text-xs font-semibold bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full">RESSARCIMENTO</span>
                        </div>
                        <h3 class="text-lg font-bold text-adv-dark mb-2 group-hover:text-emerald-600">Procedimento de Ressarcimento</h3>
                        <p class="text-adv-muted text-sm mb-4">Para apuração de responsabilidade civil por danos à fazenda pública</p>
                        <div class="flex items-center text-sm text-emerald-600">
                            <span>Iniciar Procedimento</span>
                            <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </div>
                </div>
                
                <div id="procedimento-selecionado" class="hidden mt-8 animate-fade-in">
                    <div class="bg-gradient-to-r from-adv-primary/5 to-adv-accent/5 border border-adv-primary/20 rounded-xl p-6">
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div>
                                <div class="flex items-center mb-2">
                                    <div id="procedimento-icon" class="w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas text-white"></i>
                                    </div>
                                    <div>
                                        <h3 id="procedimento-nome" class="text-xl font-bold text-adv-dark"></h3>
                                        <p id="procedimento-descricao" class="text-adv-muted"></p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="sistema.avancarParaCaracterizacao()" 
                                    class="mt-4 md:mt-0 bg-gradient-to-r from-adv-primary to-adv-accent text-white px-8 py-3 rounded-lg font-medium hover:shadow-lg hover:shadow-adv-primary/25 transition-all flex items-center">
                                Continuar para Caracterização
                                <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Caracterização -->
            <div id="content-caracterizacao" class="hidden animate-slide-in">
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-adv-dark mb-2">Caracterização do Procedimento</h2>
                            <p class="text-adv-muted">Preencha os dados fundamentais que serão utilizados em todos os documentos</p>
                        </div>
                        <div class="flex items-center space-x-2 text-sm">
                            <span class="text-adv-muted">Procedimento:</span>
                            <span id="procedimento-atual-badge" class="font-semibold bg-blue-50 text-blue-700 px-3 py-1 rounded-full"></span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Coluna 1 -->
                    <div class="space-y-6">
                        <!-- Portaria -->
                        <div class="bg-white rounded-xl border border-adv-border p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center mr-3">
                                    <i class="fas fa-file-signature text-blue-600"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-adv-dark">Portaria de Instauração</h3>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-adv-text mb-2">Número da Portaria</label>
                                    <input type="text" id="numero-portaria" 
                                           class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none"
                                           placeholder="Ex: 05.02/2024/SD/SJD/PMAM">
                                    <p class="text-xs text-adv-muted mt-1">Este número será utilizado como referência em todos os documentos</p>
                                </div>
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-adv-text mb-2">Dia</label>
                                        <input type="number" id="data-dia" min="1" max="31"
                                               class="input-adv w-full p-3 border border-adv-border rounded-lg text-center focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-adv-text mb-2">Mês</label>
                                        <input type="text" id="data-mes" 
                                               class="input-adv w-full p-3 border border-adv-border rounded-lg text-center focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-adv-text mb-2">Ano</label>
                                        <input type="number" id="data-ano" min="2000" max="2100"
                                               class="input-adv w-full p-3 border border-adv-border rounded-lg text-center focus:outline-none">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Local e Unidade -->
                        <div class="bg-white rounded-xl border border-adv-border p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center mr-3">
                                    <i class="fas fa-building text-purple-600"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-adv-dark">Local e Unidade</h3>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-adv-text mb-2">Local da Instauração</label>
                                <input type="text" id="local-unidade" 
                                       class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none"
                                       placeholder="Ex: SJD do Comando de Policiamento Leste">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Coluna 2 -->
                    <div class="space-y-6">
                        <!-- Envolvidos -->
                        <div class="bg-white rounded-xl border border-adv-border p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center mr-3">
                                    <i class="fas fa-users text-emerald-600"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-adv-dark">Envolvidos no Procedimento</h3>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-adv-text mb-2">Encarregado/Sindicante</label>
                                    <input type="text" id="encarregado-nome" 
                                           class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none"
                                           placeholder="Nome, Posto/Grad e CI">
                                </div>
                                <div>
                                    <label id="titulo-acusado" class="block text-sm font-medium text-adv-text mb-2">Acusado/Sindicado</label>
                                    <input type="text" id="acusado-nome" 
                                           class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none"
                                           placeholder="Nome, Posto/Grad e CI">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-adv-text mb-2">Ofendido/Vítima</label>
                                    <select id="ofendido-tipo" class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none">
                                        <option value="PMAM">Polícia Militar do Amazonas</option>
                                        <option value="FAZENDA">Fazenda Pública/PMAM</option>
                                        <option value="PARTICULAR">Particular</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Objeto -->
                        <div class="bg-white rounded-xl border border-adv-border p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-lg bg-amber-50 flex items-center justify-center mr-3">
                                    <i class="fas fa-bullseye text-amber-600"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-adv-dark">Objeto da Apuração</h3>
                            </div>
                            <div>
                                <textarea id="objeto-apuracao" rows="3"
                                          class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none resize-none"
                                          placeholder="Descreva sucintamente o objeto do procedimento..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-adv-border">
                    <button onclick="sistema.navegarPara('procedimento')" 
                            class="px-6 py-3 border border-adv-border text-adv-text rounded-lg font-medium hover:bg-adv-surface transition-all flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Voltar
                    </button>
                    <button onclick="sistema.avancarParaDocumentos()" 
                            class="bg-gradient-to-r from-adv-primary to-adv-accent text-white px-8 py-3 rounded-lg font-medium hover:shadow-lg hover:shadow-adv-primary/25 transition-all flex items-center">
                        Continuar para Documentos
                        <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
            
            <!-- Step 3: Documentos -->
            <div id="content-documentos" class="hidden animate-slide-in">
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-adv-dark mb-2">Documentos do Procedimento</h2>
                            <p class="text-adv-muted">Selecione e preencha os documentos necessários para o procedimento</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm">
                                <span class="text-adv-muted">Documentos:</span>
                                <span class="font-semibold text-adv-primary">0/7</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <button onclick="sistema.selecionarDocumento('autuacao')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-file-signature text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Autuação</div>
                        <div class="text-xs text-adv-muted">Termo inicial do procedimento</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('abertura')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-folder-open text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Abertura</div>
                        <div class="text-xs text-adv-muted">Termo de abertura formal</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('designacao')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-user-tie text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Designação</div>
                        <div class="text-xs text-adv-muted">Nomeação de escrivão</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('termos')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-gavel text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Termos</div>
                        <div class="text-xs text-adv-muted">Declarações e interrogatórios</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('oficios')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-envelope text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Ofícios</div>
                        <div class="text-xs text-adv-muted">Comunicações oficiais</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('certidoes')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-certificate text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Certidões</div>
                        <div class="text-xs text-adv-muted">Documentos certificados</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('relatorio')" 
                            class="doc-btn group bg-white rounded-xl border-2 border-adv-border p-5 text-center hover:border-adv-secondary transition-all hover:shadow-adv-lg">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-file-contract text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Relatório</div>
                        <div class="text-xs text-adv-muted">Relatório final e conclusão</div>
                    </button>
                    
                    <button onclick="sistema.visualizarTodosDocumentos()" 
                            class="doc-btn group bg-gradient-to-br from-adv-primary/5 to-adv-accent/5 rounded-xl border-2 border-dashed border-adv-border p-5 text-center hover:border-adv-secondary transition-all">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-adv-primary to-adv-accent flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                            <i class="fas fa-eye text-white text-xl"></i>
                        </div>
                        <div class="font-semibold text-adv-dark mb-1">Visão Geral</div>
                        <div class="text-xs text-adv-muted">Ver todos os documentos</div>
                    </button>
                </div>
                
                <!-- Formulário do Documento -->
                <div id="formulario-documento" class="hidden animate-fade-in bg-white rounded-xl border border-adv-border p-6 mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center">
                            <div id="doc-icon" class="w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas text-white"></i>
                            </div>
                            <div>
                                <h3 id="titulo-documento-selecionado" class="text-lg font-bold text-adv-dark"></h3>
                                <p class="text-sm text-adv-muted" id="documento-descricao"></p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="sistema.limparDocumento()" 
                                    class="px-4 py-2 border border-adv-border rounded-lg text-adv-text hover:bg-adv-surface">
                                Limpar
                            </button>
                            <button onclick="sistema.salvarDocumento()" 
                                    class="px-4 py-2 bg-adv-secondary text-white rounded-lg hover:bg-blue-600">
                                Salvar
                            </button>
                        </div>
                    </div>
                    
                    <div id="campos-documento" class="space-y-4"></div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-adv-border">
                    <button onclick="sistema.navegarPara('caracterizacao')" 
                            class="px-6 py-3 border border-adv-border text-adv-text rounded-lg font-medium hover:bg-adv-surface transition-all flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Voltar
                    </button>
                    <button onclick="sistema.avancarParaPreview()" 
                            class="bg-gradient-to-r from-adv-primary to-adv-accent text-white px-8 py-3 rounded-lg font-medium hover:shadow-lg hover:shadow-adv-primary/25 transition-all flex items-center">
                        Visualizar Documentos
                        <i class="fas fa-eye ml-2"></i>
                    </button>
                </div>
            </div>
            
            <!-- Step 4: Preview -->
            <div id="content-preview" class="hidden animate-slide-in">
                <div class="mb-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-adv-dark mb-2">Edição e Visualização</h2>
                            <p class="text-adv-muted">Revise, edite e exporte os documentos do procedimento</p>
                        </div>
                        <div class="flex items-center space-x-4 mt-4 md:mt-0">
                            <div class="text-sm text-center">
                                <div class="font-semibold text-adv-primary" id="doc-count">0 documentos</div>
                                <div class="text-xs text-adv-muted">preenchidos</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Editor e Visualização -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Editor -->
                    <div class="bg-white rounded-xl border border-adv-border overflow-hidden">
                        <div class="border-b border-adv-border p-4">
                            <div class="flex items-center justify-between">
                                <h3 class="font-semibold text-adv-dark">Editor de Documento</h3>
                                <div class="flex items-center space-x-2">
                                    <select id="seletor-documento" 
                                            class="text-sm border border-adv-border rounded-lg px-3 py-1 focus:outline-none">
                                        <option value="">Selecione um documento</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="p-1">
                            <div id="editor-documento" 
                                 class="preview-editor w-full h-[500px] p-6 text-sm border-0 focus:outline-none custom-scrollbar"
                                 contenteditable="true"
                                 spellcheck="false">
                                Selecione um documento para editar...
                            </div>
                        </div>
                        <div class="border-t border-adv-border p-4">
                            <div class="flex justify-between items-center">
                                <div class="text-sm text-adv-muted">
                                    <i class="fas fa-edit mr-1"></i>
                                    Modo de edição ativo
                                </div>
                                <button onclick="sistema.atualizarPreview()" 
                                        class="px-4 py-2 bg-adv-success text-white rounded-lg hover:bg-green-600 text-sm">
                                    <i class="fas fa-sync-alt mr-1"></i>
                                    Atualizar Visualização
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Visualização -->
                    <div class="bg-white rounded-xl border border-adv-border overflow-hidden">
                        <div class="border-b border-adv-border p-4">
                            <div class="flex items-center justify-between">
                                <h3 class="font-semibold text-adv-dark">Pré-visualização</h3>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded" id="preview-tipo"></span>
                                </div>
                            </div>
                        </div>
                        <div class="p-1">
                            <div id="preview-conteudo" 
                                 class="preview-editor w-full h-[500px] p-6 text-sm bg-adv-surface custom-scrollbar">
                                Selecione um documento para visualizar...
                            </div>
                        </div>
                        <div class="border-t border-adv-border p-4">
                            <div class="flex flex-wrap gap-2">
                                <button onclick="sistema.gerarPDF()" 
                                        class="flex-1 min-w-[120px] px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm flex items-center justify-center">
                                    <i class="fas fa-file-pdf mr-2"></i>
                                    Exportar PDF
                                </button>
                                <button onclick="sistema.copiarTexto()" 
                                        class="flex-1 min-w-[120px] px-4 py-2 bg-adv-primary text-white rounded-lg hover:bg-blue-800 text-sm flex items-center justify-center">
                                    <i class="fas fa-copy mr-2"></i>
                                    Copiar Texto
                                </button>
                                <button onclick="sistema.imprimirDocumento()" 
                                        class="flex-1 min-w-[120px] px-4 py-2 bg-adv-secondary text-white rounded-lg hover:bg-blue-600 text-sm flex items-center justify-center">
                                    <i class="fas fa-print mr-2"></i>
                                    Imprimir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Controles de Navegação -->
                <div class="flex justify-between mt-8 pt-6 border-t border-adv-border">
                    <div class="flex space-x-3">
                        <button onclick="sistema.navegarPara('documentos')" 
                                class="px-6 py-3 border border-adv-border text-adv-text rounded-lg font-medium hover:bg-adv-surface transition-all flex items-center">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Voltar para Documentos
                        </button>
                        <button onclick="sistema.iniciarNovoProcedimento()" 
                                class="px-6 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-lg font-medium hover:shadow-lg hover:shadow-emerald-500/25 transition-all flex items-center">
                            <i class="fas fa-plus mr-2"></i>
                            Novo Procedimento
                        </button>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="sistema.salvarRascunho()" 
                                class="px-6 py-3 border border-adv-border text-adv-text rounded-lg font-medium hover:bg-adv-surface transition-all flex items-center">
                            <i class="fas fa-save mr-2"></i>
                            Salvar Rascunho
                        </button>
                        <button onclick="sistema.finalizarProcedimento()" 
                                class="px-6 py-3 bg-gradient-to-r from-adv-primary to-adv-accent text-white rounded-lg font-medium hover:shadow-lg hover:shadow-adv-primary/25 transition-all flex items-center">
                            <i class="fas fa-check-circle mr-2"></i>
                            Finalizar Procedimento
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 space-y-3 w-80"></div>
    
    <!-- Help Modal -->
    <div id="help-modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-adv-xl w-full max-w-2xl">
            <div class="p-6 border-b border-adv-border">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-adv-dark">Ajuda do Sistema</h3>
                    <button onclick="sistema.fecharHelp()" class="text-adv-muted hover:text-adv-dark">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-adv-dark mb-2">Como usar o sistema:</h4>
                        <ol class="list-decimal pl-5 space-y-2 text-adv-text">
                            <li>Selecione o tipo de procedimento desejado</li>
                            <li>Preencha os dados básicos na etapa de caracterização</li>
                            <li>Gere os documentos necessários para o procedimento</li>
                            <li>Revise, edite e exporte os documentos na etapa de preview</li>
                        </ol>
                    </div>
                    <div>
                        <h4 class="font-semibold text-adv-dark mb-2">Dicas de uso:</h4>
                        <ul class="list-disc pl-5 space-y-2 text-adv-text">
                            <li>Passe o mouse sobre as abas para pré-visualizar</li>
                            <li>Clique em "Editar" no preview para fazer ajustes diretos</li>
                            <li>Use Ctrl+S para salvar durante a edição</li>
                            <li>Exporte sempre em PDF para manter a formatação</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;
        
        class SistemaProcedimentosAdvocacy {
            constructor() {
                this.procedimentoSelecionado = null;
                this.documentoSelecionado = null;
                this.dadosCaracterizacao = {};
                this.documentosPreenchidos = {};
                this.indicatorPositions = [16, 140 + 16, 280 + 16, 420 + 16];
                this.currentTab = 'procedimento';
                this.definirModelos();
                this.inicializarEventos();
                this.preencherDataAtual();
                this.atualizarProgresso();
            }
            
            inicializarEventos() {
                // Eventos de ajuda
                document.getElementById('help-btn').addEventListener('click', () => this.mostrarHelp());
                
                // Eventos de teclado para o editor
                document.getElementById('editor-documento').addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        this.atualizarPreview();
                    }
                });
                
                // Auto-save enquanto digita (com debounce)
                let timeout;
                document.getElementById('editor-documento').addEventListener('input', () => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        if (this.documentoSelecionado) {
                            this.documentosPreenchidos[this.documentoSelecionado] = 
                                document.getElementById('editor-documento').innerText;
                        }
                    }, 1000);
                });
                
                // Atualizar seletor de documento
                document.getElementById('seletor-documento').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.carregarDocumentoParaEdicao(e.target.value);
                    }
                });
            }
            
            navegarPara(tab) {
                // Validar navegação
                if (tab === 'caracterizacao' && !this.procedimentoSelecionado) {
                    this.mostrarToast('Selecione um tipo de procedimento primeiro', 'aviso');
                    return;
                }
                if (tab === 'documentos' && !this.dadosCaracterizacao.procedimento) {
                    this.mostrarToast('Preencha a caracterização primeiro', 'aviso');
                    return;
                }
                if (tab === 'preview' && Object.keys(this.documentosPreenchidos).length === 0) {
                    this.mostrarToast('Crie pelo menos um documento primeiro', 'aviso');
                    return;
                }
                
                this.currentTab = tab;
                this.atualizarInterfaceTab();
                this.atualizarProgresso();
                
                // Animar transição
                const content = document.getElementById(`content-${tab}`);
                content.classList.remove('animate-slide-in');
                void content.offsetWidth; // Trigger reflow
                content.classList.add('animate-slide-in');
            }
            
            hoverTab(tab) {
                if (this.validarNavegacao(tab)) {
                    const tabElement = document.getElementById(`tab-${tab}`);
                    const indicator = document.getElementById('tab-indicator');
                    const rect = tabElement.getBoundingClientRect();
                    const containerRect = document.querySelector('.tab-nav').getBoundingClientRect();
                    
                    indicator.style.left = `${rect.left - containerRect.left}px`;
                    indicator.style.width = `${rect.width}px`;
                    indicator.style.opacity = '0.5';
                }
            }
            
            validarNavegacao(tab) {
                switch(tab) {
                    case 'caracterizacao': return !!this.procedimentoSelecionado;
                    case 'documentos': return !!this.dadosCaracterizacao.procedimento;
                    case 'preview': return Object.keys(this.documentosPreenchidos).length > 0;
                    default: return true;
                }
            }
            
            atualizarInterfaceTab() {
                // Atualizar indicador
                const tabElement = document.getElementById(`tab-${this.currentTab}`);
                const indicator = document.getElementById('tab-indicator');
                const rect = tabElement.getBoundingClientRect();
                const containerRect = document.querySelector('.tab-nav').getBoundingClientRect();
                
                indicator.style.left = `${rect.left - containerRect.left}px`;
                indicator.style.width = `${rect.width}px`;
                indicator.style.opacity = '1';
                
                // Atualizar abas
                ['procedimento', 'caracterizacao', 'documentos', 'preview'].forEach(tab => {
                    const tabBtn = document.getElementById(`tab-${tab}`);
                    const content = document.getElementById(`content-${tab}`);
                    
                    if (tab === this.currentTab) {
                        tabBtn.classList.add('active');
                        tabBtn.classList.remove('disabled');
                        content.classList.remove('hidden');
                        
                        // Atualizar ícone da aba ativa
                        const icon = tabBtn.querySelector('.w-8');
                        icon.classList.remove('bg-adv-border');
                        icon.classList.add('bg-adv-primary/10');
                        
                        const tabIcon = tabBtn.querySelector('i');
                        tabIcon.classList.remove('text-adv-muted');
                        tabIcon.classList.add('text-adv-primary');
                    } else {
                        tabBtn.classList.remove('active');
                        content.classList.add('hidden');
                        
                        // Habilitar/desabilitar baseado no progresso
                        const podeAcessar = this.validarNavegacao(tab);
                        tabBtn.classList.toggle('disabled', !podeAcessar);
                        
                        const icon = tabBtn.querySelector('.w-8');
                        const tabIcon = tabBtn.querySelector('i');
                        
                        if (podeAcessar) {
                            icon.classList.add('bg-adv-border');
                            icon.classList.remove('bg-adv-primary/10');
                            tabIcon.classList.add('text-adv-muted');
                            tabIcon.classList.remove('text-adv-primary');
                        }
                    }
                });
                
                // Atualizar título do passo atual
                const stepTitles = {
                    'procedimento': 'Tipo de Procedimento',
                    'caracterizacao': 'Caracterização',
                    'documentos': 'Documentos',
                    'preview': 'Edição e Visualização'
                };
                document.getElementById('current-step').textContent = stepTitles[this.currentTab];
            }
            
            atualizarProgresso() {
                const steps = ['progress-2', 'progress-3', 'progress-4'];
                const currentStepIndex = ['procedimento', 'caracterizacao', 'documentos', 'preview'].indexOf(this.currentTab);
                
                steps.forEach((stepId, index) => {
                    const dot = document.getElementById(stepId);
                    if (index < currentStepIndex) {
                        dot.classList.add('active');
                        dot.classList.remove('bg-adv-border');
                    } else if (index === currentStepIndex) {
                        dot.classList.add('bg-adv-secondary');
                        dot.classList.remove('bg-adv-border', 'active');
                    } else {
                        dot.classList.remove('active', 'bg-adv-secondary');
                        dot.classList.add('bg-adv-border');
                    }
                });
                
                // Atualizar contagem de documentos
                const docCount = Object.keys(this.documentosPreenchidos).length;
                document.getElementById('doc-count').textContent = `${docCount} documento${docCount !== 1 ? 's' : ''}`;
            }
            
            selecionarProcedimento(tipo) {
                const procedimentos = {
                    SD: { 
                        id: 'SD', 
                        nome: 'SINDICÂNCIA DISCIPLINAR',
                        descricao: 'Para apuração de infrações disciplinares cometidas por militares.',
                        cor: 'blue',
                        icon: 'fa-gavel'
                    },
                    SI: { 
                        id: 'SI', 
                        nome: 'SINDICÂNCIA INVESTIGATIVA',
                        descricao: 'Para investigação de fatos que possam configurar infrações disciplinares ou penais.',
                        cor: 'purple',
                        icon: 'fa-search'
                    },
                    IPM: { 
                        id: 'IPM', 
                        nome: 'INQUÉRITO POLICIAL MILITAR',
                        descricao: 'Para investigação de infrações penais militares.',
                        cor: 'red',
                        icon: 'fa-shield-alt'
                    },
                    PAD: { 
                        id: 'PAD', 
                        nome: 'PROCESSO ADMINISTRATIVO DISCIPLINAR',
                        descricao: 'Processo formal para apuração de infrações disciplinares graves.',
                        cor: 'amber',
                        icon: 'fa-scale-balanced'
                    },
                    PARE: { 
                        id: 'PARE', 
                        nome: 'PROCEDIMENTO DE RESSARCIMENTO',
                        descricao: 'Para apuração de responsabilidade civil por danos à fazenda pública.',
                        cor: 'emerald',
                        icon: 'fa-hand-holding-usd'
                    }
                };
                
                this.procedimentoSelecionado = procedimentos[tipo];
                
                // Atualizar interface
                const infoDiv = document.getElementById('procedimento-selecionado');
                infoDiv.classList.remove('hidden');
                
                document.getElementById('procedimento-nome').textContent = 
                    `${this.procedimentoSelecionado.id} - ${this.procedimentoSelecionado.nome}`;
                document.getElementById('procedimento-descricao').textContent = this.procedimentoSelecionado.descricao;
                
                // Atualizar ícone
                const iconDiv = document.getElementById('procedimento-icon');
                iconDiv.className = `w-10 h-10 rounded-lg flex items-center justify-center mr-3 bg-gradient-to-br from-${this.procedimentoSelecionado.cor}-500 to-${this.procedimentoSelecionado.cor}-600`;
                iconDiv.innerHTML = `<i class="fas ${this.procedimentoSelecionado.icon} text-white"></i>`;
                
                // Destacar card selecionado
                document.querySelectorAll('.card-hover').forEach(card => {
                    card.classList.remove('border-blue-500', 'border-purple-500', 'border-red-500', 'border-amber-500', 'border-emerald-500');
                });
                
                // Atualizar título do acusado para PARE
                if (tipo === 'PARE') {
                    document.getElementById('titulo-acusado').textContent = 'Indiciado/Responsável';
                } else {
                    document.getElementById('titulo-acusado').textContent = 'Acusado/Sindicado';
                }
                
                this.mostrarToast('Procedimento selecionado com sucesso', 'sucesso');
            }
            
            avancarParaCaracterizacao() {
                if (!this.procedimentoSelecionado) {
                    this.mostrarToast('Selecione um tipo de procedimento primeiro', 'erro');
                    return;
                }
                
                this.navegarPara('caracterizacao');
                
                // Atualizar badge
                document.getElementById('procedimento-atual-badge').textContent = 
                    `${this.procedimentoSelecionado.id} - ${this.procedimentoSelecionado.nome}`;
                
                // Preencher número da portaria com padrão
                const ano = document.getElementById('data-ano').value;
                const numeroPadrao = `XX.XX/${ano}/${this.procedimentoSelecionado.id}/SJD/PMAM`;
                document.getElementById('numero-portaria').value = numeroPadrao;
                
                this.mostrarToast('Preencha os dados básicos do procedimento', 'info');
            }
            
            avancarParaDocumentos() {
                // Coletar dados
                this.dadosCaracterizacao = {
                    procedimento: this.procedimentoSelecionado,
                    portaria: {
                        numero: document.getElementById('numero-portaria').value,
                        data: `${document.getElementById('data-dia').value} de ${document.getElementById('data-mes').value} de ${document.getElementById('data-ano').value}`
                    },
                    data: {
                        dia: document.getElementById('data-dia').value,
                        mes: document.getElementById('data-mes').value,
                        ano: document.getElementById('data-ano').value
                    },
                    local: {
                        unidade: document.getElementById('local-unidade').value
                    },
                    encarregado: {
                        nome: document.getElementById('encarregado-nome').value,
                        cargo: 'Encarregado/Sindicante'
                    },
                    acusado: {
                        nome: document.getElementById('acusado-nome').value,
                        lotacao: 'Lotação/Unidade'
                    },
                    ofendido: {
                        tipo: document.getElementById('ofendido-tipo').value,
                        nome: document.getElementById('ofendido-tipo').options[document.getElementById('ofendido-tipo').selectedIndex].text
                    },
                    objeto: {
                        apuracao: document.getElementById('objeto-apuracao').value
                    }
                };
                
                this.navegarPara('documentos');
                this.mostrarToast('Dados básicos salvos. Agora crie os documentos.', 'sucesso');
            }
            
            definirModelos() {
                this.modelosDocumentos = {
                    autuacao: {
                        titulo: "AUTUAÇÃO",
                        descricao: "Termo inicial de autuação do procedimento",
                        icon: "fa-file-signature",
                        cor: "blue",
                        campos: [
                            { id: 'escrivao_nome', label: 'Escrivão Designado', tipo: 'text' }
                        ],
                        template: (dados) => `
                            ${dados.procedimento.nome.toUpperCase()}
                            
                            ENCARREGADO: ${dados.encarregado.nome}
                            ACUSADO: ${dados.acusado.nome}
                            OFENDIDO: ${dados.ofendido.nome}
                            
                            A U T U A Ç Ã O
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, nesta cidade de Manaus, Estado do Amazonas, na ${dados.local.unidade}, autuo a Portaria nº ${dados.portaria.numero}, datada de ${dados.portaria.data}, e demais documentos que a este junto, do que para constar, lavro o presente termo. Eu, ${dados.encarregado.nome}, Encarregado que o digitei e assino.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado / Sindicante
                        `
                    },
                    
                    abertura: {
                        titulo: "TERMO DE ABERTURA",
                        descricao: "Termo formal de abertura do procedimento",
                        icon: "fa-folder-open",
                        cor: "purple",
                        campos: [],
                        template: (dados) => `
                            TERMO DE ABERTURA
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, nesta cidade de Manaus, Estado do Amazonas, na ${dados.local.unidade}, dei início ao presente ${dados.procedimento.nome.toUpperCase()}, tendo como objeto: ${dados.objeto.apuracao}. Do que para constar lavro o presente Termo que o escrevi e assino.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado / Sindicante
                        `
                    },
                    
                    designacao: {
                        titulo: "DESIGNAÇÃO DE ESCRIVÃO",
                        descricao: "Nomeação formal do escrivão do procedimento",
                        icon: "fa-user-tie",
                        cor: "emerald",
                        campos: [
                            { id: 'escrivao_designado', label: 'Nome e Posto/Grad do Escrivão', tipo: 'text' }
                        ],
                        template: (dados) => `
                            TERMO DE DESIGNAÇÃO DE ESCRIVÃO
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, eu, ${dados.encarregado.nome}, Encarregado, RESOLVO:
                            
                            DESIGNAR o ${dados.campos?.escrivao_designado || '____________________'}, para exercer a função de **Escrivão** no presente ${dados.procedimento.nome.toUpperCase()} acima referenciado, devendo cumprir todas as determinações legais inerentes ao cargo.
                            
                            Para constar, lavro o presente termo que vai assinado.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado / Sindicante
                        `
                    }
                };
            }
            
            selecionarDocumento(tipo) {
                this.documentoSelecionado = tipo;
                const modelo = this.modelosDocumentos[tipo];
                
                // Atualizar interface
                const formDiv = document.getElementById('formulario-documento');
                formDiv.classList.remove('hidden');
                
                document.getElementById('titulo-documento-selecionado').textContent = modelo.titulo;
                document.getElementById('documento-descricao').textContent = modelo.descricao;
                
                // Atualizar ícone
                const iconDiv = document.getElementById('doc-icon');
                iconDiv.className = `w-10 h-10 rounded-lg flex items-center justify-center mr-3 bg-gradient-to-br from-${modelo.cor}-500 to-${modelo.cor}-600`;
                iconDiv.innerHTML = `<i class="fas ${modelo.icon} text-white"></i>`;
                
                // Gerar campos
                const container = document.getElementById('campos-documento');
                container.innerHTML = '';
                
                if (modelo.campos && modelo.campos.length > 0) {
                    modelo.campos.forEach(campo => {
                        const div = document.createElement('div');
                        div.className = 'mb-4';
                        
                        let input = '';
                        if (campo.tipo === 'textarea') {
                            input = `<textarea id="doc-${campo.id}" class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none" rows="4" placeholder="${campo.label}"></textarea>`;
                        } else if (campo.tipo === 'select') {
                            const opcoes = campo.opcoes.map(op => `<option value="${op}">${op}</option>`).join('');
                            input = `<select id="doc-${campo.id}" class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none">${opcoes}</select>`;
                        } else {
                            input = `<input type="text" id="doc-${campo.id}" class="input-adv w-full p-3 border border-adv-border rounded-lg focus:outline-none" placeholder="${campo.label}">`;
                        }
                        
                        div.innerHTML = `
                            <label class="block text-sm font-medium text-adv-text mb-2">${campo.label}:</label>
                            ${input}
                        `;
                        
                        container.appendChild(div);
                    });
                } else {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-info-circle text-adv-muted text-3xl mb-3"></i>
                            <p class="text-adv-muted">Este documento não requer campos adicionais.</p>
                            <p class="text-sm text-adv-muted mt-1">Clique em "Salvar" para gerar o documento.</p>
                        </div>
                    `;
                }
                
                // Destacar botão selecionado
                document.querySelectorAll('.doc-btn').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'border-purple-500', 'border-emerald-500');
                });
            }
            
            salvarDocumento() {
                if (!this.documentoSelecionado) return;
                
                // Coletar dados dos campos
                const campos = {};
                const modelo = this.modelosDocumentos[this.documentoSelecionado];
                
                modelo.campos.forEach(campo => {
                    const elemento = document.getElementById(`doc-${campo.id}`);
                    if (elemento) {
                        campos[campo.id] = elemento.value;
                    }
                });
                
                // Combinar dados e gerar documento
                const dadosCompletos = {
                    ...this.dadosCaracterizacao,
                    campos: campos
                };
                
                const conteudo = modelo.template(dadosCompletos);
                this.documentosPreenchidos[this.documentoSelecionado] = conteudo;
                
                // Atualizar seletor de documentos no preview
                this.atualizarSeletorDocumentos();
                
                this.mostrarToast('Documento salvo com sucesso', 'sucesso');
                
                // Limpar formulário
                document.getElementById('formulario-documento').classList.add('hidden');
                this.documentoSelecionado = null;
            }
            
            avancarParaPreview() {
                if (Object.keys(this.documentosPreenchidos).length === 0) {
                    this.mostrarToast('Crie pelo menos um documento primeiro', 'erro');
                    return;
                }
                
                this.navegarPara('preview');
                this.atualizarSeletorDocumentos();
                
                // Carregar primeiro documento no editor
                const primeiroDoc = Object.keys(this.documentosPreenchidos)[0];
                this.carregarDocumentoParaEdicao(primeiroDoc);
            }
            
            atualizarSeletorDocumentos() {
                const seletor = document.getElementById('seletor-documento');
                seletor.innerHTML = '<option value="">Selecione um documento</option>';
                
                Object.keys(this.documentosPreenchidos).forEach(doc => {
                    const modelo = this.modelosDocumentos[doc];
                    const option = document.createElement('option');
                    option.value = doc;
                    option.textContent = modelo.titulo;
                    seletor.appendChild(option);
                });
            }
            
            carregarDocumentoParaEdicao(docId) {
                const conteudo = this.documentosPreenchidos[docId];
                const modelo = this.modelosDocumentos[docId];
                
                document.getElementById('editor-documento').innerText = conteudo;
                document.getElementById('preview-conteudo').textContent = conteudo;
                document.getElementById('preview-tipo').textContent = modelo.titulo;
                
                this.documentoSelecionado = docId;
            }
            
            atualizarPreview() {
                if (!this.documentoSelecionado) return;
                
                const novoConteudo = document.getElementById('editor-documento').innerText;
                this.documentosPreenchidos[this.documentoSelecionado] = novoConteudo;
                document.getElementById('preview-conteudo').textContent = novoConteudo;
                
                this.mostrarToast('Documento atualizado', 'sucesso');
            }
            
            preencherDataAtual() {
                const hoje = new Date();
                const meses = [
                    'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                ];
                
                document.getElementById('data-dia').value = hoje.getDate();
                document.getElementById('data-mes').value = meses[hoje.getMonth()];
                document.getElementById('data-ano').value = hoje.getFullYear();
            }
            
            gerarPDF() {
                if (!this.documentoSelecionado) {
                    this.mostrarToast('Selecione um documento primeiro', 'erro');
                    return;
                }
                
                const conteudo = this.documentosPreenchidos[this.documentoSelecionado];
                const modelo = this.modelosDocumentos[this.documentoSelecionado];
                
                const doc = new jsPDF();
                doc.setFont('helvetica');
                doc.setFontSize(11);
                
                const margem = 20;
                const largura = 210 - 2 * margem;
                
                // Título
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(`${this.procedimentoSelecionado.id} - ${modelo.titulo}`, 105, margem, { align: 'center' });
                
                // Conteúdo
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                const linhas = doc.splitTextToSize(conteudo, largura);
                doc.text(linhas, margem, margem + 15);
                
                const nomeArquivo = `${this.procedimentoSelecionado.id}_${this.documentoSelecionado}_${new Date().getTime()}.pdf`;
                doc.save(nomeArquivo);
                
                this.mostrarToast('PDF gerado com sucesso!', 'sucesso');
            }
            
            copiarTexto() {
                const texto = document.getElementById('preview-conteudo').textContent;
                navigator.clipboard.writeText(texto)
                    .then(() => this.mostrarToast('Texto copiado para a área de transferência!', 'sucesso'))
                    .catch(() => this.mostrarToast('Erro ao copiar texto.', 'erro'));
            }
            
            imprimirDocumento() {
                const conteudo = document.getElementById('preview-conteudo').textContent;
                const janela = window.open('', '_blank');
                janela.document.write(`
                    <html>
                        <head>
                            <title>Imprimir Documento</title>
                            <style>
                                body { font-family: monospace; white-space: pre-wrap; padding: 20px; }
                                @media print { body { margin: 0; } }
                            </style>
                        </head>
                        <body>${conteudo}</body>
                    </html>
                `);
                janela.document.close();
                janela.focus();
                janela.print();
            }
            
            iniciarNovoProcedimento() {
                if (confirm('Deseja iniciar um novo procedimento? Todo o progresso atual será perdido.')) {
                    location.reload();
                }
            }
            
            salvarRascunho() {
                const dados = {
                    procedimento: this.procedimentoSelecionado,
                    caracterizacao: this.dadosCaracterizacao,
                    documentos: this.documentosPreenchidos,
                    dataSalvamento: new Date().toISOString()
                };
                
                localStorage.setItem('sispro_rascunho', JSON.stringify(dados));
                this.mostrarToast('Rascunho salvo localmente', 'sucesso');
            }
            
            finalizarProcedimento() {
                if (Object.keys(this.documentosPreenchidos).length === 0) {
                    this.mostrarToast('Crie pelo menos um documento antes de finalizar', 'erro');
                    return;
                }
                
                this.mostrarToast('Procedimento finalizado com sucesso!', 'sucesso');
                // Aqui poderia ter lógica para enviar para um servidor, etc.
            }
            
            mostrarHelp() {
                document.getElementById('help-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
            
            fecharHelp() {
                document.getElementById('help-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
            
            mostrarToast(mensagem, tipo) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                let cor = 'bg-adv-primary';
                let icone = 'fas fa-info-circle';
                
                if (tipo === 'sucesso') {
                    cor = 'bg-adv-success';
                    icone = 'fas fa-check-circle';
                } else if (tipo === 'erro') {
                    cor = 'bg-adv-error';
                    icone = 'fas fa-exclamation-circle';
                } else if (tipo === 'aviso') {
                    cor = 'bg-adv-warning';
                    icone = 'fas fa-exclamation-triangle';
                }
                
                toast.className = `${cor} text-white p-4 rounded-xl shadow-adv-xl transform translate-x-full animate-slide-in`;
                toast.innerHTML = `
                    <div class="flex items-center">
                        <i class="${icone} mr-3 text-lg"></i>
                        <div class="flex-1">
                            <div class="font-medium">${mensagem}</div>
                        </div>
                        <button class="ml-4 text-white/70 hover:text-white" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(toast);
                
                // Remover automaticamente após 5 segundos
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.classList.add('opacity-0', 'translate-x-full');
                        setTimeout(() => {
                            if (toast.parentElement) {
                                container.removeChild(toast);
                            }
                        }, 300);
                    }
                }, 5000);
            }
            
            // Métodos auxiliares
            limparDocumento() {
                document.getElementById('editor-documento').innerText = '';
                document.getElementById('preview-conteudo').textContent = '';
                this.mostrarToast('Documento limpo', 'info');
            }
            
            visualizarTodosDocumentos() {
                let todosDocumentos = '';
                Object.keys(this.documentosPreenchidos).forEach(doc => {
                    const modelo = this.modelosDocumentos[doc];
                    todosDocumentos += `\n\n=== ${modelo.titulo} ===\n\n`;
                    todosDocumentos += this.documentosPreenchidos[doc];
                });
                
                document.getElementById('editor-documento').innerText = todosDocumentos || 'Nenhum documento criado ainda';
                document.getElementById('preview-conteudo').textContent = todosDocumentos || 'Nenhum documento criado ainda';
                
                if (Object.keys(this.documentosPreenchidos).length > 0) {
                    this.navegarPara('preview');
                }
            }
        }
        
        // Inicializar sistema
        const sistema = new SistemaProcedimentosAdvocacy();
    </script>
</body>
</html>
