<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISPRO - PMAM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pmam-blue': '#1e3a8a',
                        'pmam-light': '#3b82f6',
                        'pmam-accent': '#0ea5e9',
                        'pmam-success': '#10b981',
                        'pmam-error': '#ef4444',
                        'pmam-gray': '#64748b',
                        'pmam-bg': '#f8fafc',
                        'pmam-card': '#ffffff',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Estilos para abas */
        .tab {
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background-color: #0ea5e9;
            color: white;
            border-bottom: 3px solid #1e3a8a;
        }
        
        .tab:not(.active):hover {
            background-color: #e0f2fe;
        }
        
        /* Preview de documento */
        .preview-doc {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background-color: #f0f4f8;
            border-left: 4px solid #1e3a8a;
        }
        
        /* Animação de abas */
        .tab-content {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-pmam-bg text-gray-800 min-h-screen">
    
    <!-- Cabeçalho -->
    <div class="bg-pmam-blue text-white p-4 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-2xl font-bold">
                <i class="fas fa-balance-scale-right mr-3"></i>
                SISPRO - PMAM
            </h1>
            <div class="text-sm">
                Sistema de Procedimentos da Polícia Militar do Amazonas
            </div>
        </div>
    </div>
    
    <!-- Barra de progresso/abas -->
    <div class="bg-white shadow-md">
        <div class="container mx-auto">
            <div class="flex overflow-x-auto border-b">
                <button id="tab-procedimento" class="tab active px-6 py-3 font-medium text-sm flex items-center">
                    <i class="fas fa-folder-open mr-2"></i>
                    <span class="hidden md:inline">TIPO DE PROCEDIMENTO</span>
                    <span class="md:hidden">PROCEDIMENTO</span>
                </button>
                <button id="tab-caracterizacao" class="tab px-6 py-3 font-medium text-sm flex items-center" disabled>
                    <i class="fas fa-users mr-2"></i>
                    <span class="hidden md:inline">CARACTERIZAÇÃO</span>
                    <span class="md:hidden">ENVOLVIDOS</span>
                </button>
                <button id="tab-documentos" class="tab px-6 py-3 font-medium text-sm flex items-center" disabled>
                    <i class="fas fa-file-alt mr-2"></i>
                    <span class="hidden md:inline">DOCUMENTOS</span>
                    <span class="md:hidden">DOCS</span>
                </button>
                <button id="tab-preview" class="tab px-6 py-3 font-medium text-sm flex items-center" disabled>
                    <i class="fas fa-eye mr-2"></i>
                    PREVIEW
                </button>
            </div>
        </div>
    </div>
    
    <!-- Conteúdo principal -->
    <div class="container mx-auto p-4 md:p-6">
        
        <!-- Aba 1: Tipo de Procedimento -->
        <div id="content-procedimento" class="tab-content">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-pmam-blue mb-2">
                    <i class="fas fa-folder-open mr-2"></i>
                    Selecione o Tipo de Procedimento
                </h2>
                <p class="text-gray-600 mb-6">
                    Escolha o tipo de procedimento para iniciar a elaboração dos documentos.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button onclick="sistema.selecionarProcedimento('SD')" 
                            class="procedimento-card bg-white border-2 border-gray-200 rounded-lg p-4 text-left hover:border-pmam-accent hover:shadow-md transition-all">
                        <div class="text-pmam-blue text-lg font-semibold mb-2">SD</div>
                        <div class="text-gray-700 font-medium">SINDICÂNCIA DISCIPLINAR</div>
                        <div class="text-gray-500 text-sm mt-2">
                            Para apuração de infrações disciplinares
                        </div>
                    </button>
                    
                    <button onclick="sistema.selecionarProcedimento('SI')" 
                            class="procedimento-card bg-white border-2 border-gray-200 rounded-lg p-4 text-left hover:border-pmam-accent hover:shadow-md transition-all">
                        <div class="text-pmam-blue text-lg font-semibold mb-2">SI</div>
                        <div class="text-gray-700 font-medium">SINDICÂNCIA INVESTIGATIVA</div>
                        <div class="text-gray-500 text-sm mt-2">
                            Para investigação de fatos não definidos
                        </div>
                    </button>
                    
                    <button onclick="sistema.selecionarProcedimento('IPM')" 
                            class="procedimento-card bg-white border-2 border-gray-200 rounded-lg p-4 text-left hover:border-pmam-accent hover:shadow-md transition-all">
                        <div class="text-pmam-blue text-lg font-semibold mb-2">IPM</div>
                        <div class="text-gray-700 font-medium">INQUÉRITO POLICIAL MILITAR</div>
                        <div class="text-gray-500 text-sm mt-2">
                            Para investigação de infrações penais militares
                        </div>
                    </button>
                    
                    <button onclick="sistema.selecionarProcedimento('PAD')" 
                            class="procedimento-card bg-white border-2 border-gray-200 rounded-lg p-4 text-left hover:border-pmam-accent hover:shadow-md transition-all">
                        <div class="text-pmam-blue text-lg font-semibold mb-2">PAD</div>
                        <div class="text-gray-700 font-medium">PROC. ADMINISTRATIVO DISCIPLINAR</div>
                        <div class="text-gray-500 text-sm mt-2">
                            Para processos disciplinares formais
                        </div>
                    </button>
                    
                    <button onclick="sistema.selecionarProcedimento('PARE')" 
                            class="procedimento-card bg-white border-2 border-gray-200 rounded-lg p-4 text-left hover:border-pmam-accent hover:shadow-md transition-all">
                        <div class="text-pmam-blue text-lg font-semibold mb-2">PARE</div>
                        <div class="text-gray-700 font-medium">PROCEDIMENTO DE RESSARCIMENTO</div>
                        <div class="text-gray-500 text-sm mt-2">
                            Para apuração de danos à fazenda pública
                        </div>
                    </button>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div id="info-procedimento-selecionado" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-lg text-pmam-blue" id="procedimento-nome"></h3>
                                <p class="text-gray-600" id="procedimento-descricao"></p>
                            </div>
                            <button onclick="sistema.avancarParaCaracterizacao()" 
                                    class="bg-pmam-accent text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                                <i class="fas fa-arrow-right mr-2"></i>
                                Avançar para Caracterização
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Aba 2: Caracterização -->
        <div id="content-caracterizacao" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-pmam-blue mb-4">
                    <i class="fas fa-users mr-2"></i>
                    Caracterização dos Envolvidos
                </h2>
                
                <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                    <div class="font-medium text-pmam-blue mb-2">
                        Procedimento Selecionado:
                    </div>
                    <div id="procedimento-atual-info" class="text-lg font-bold"></div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Número da Portaria -->
                    <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3">
                            <i class="fas fa-file-signature mr-2"></i>
                            Número da Portaria de Instauração
                        </h3>
                        <input type="text" id="numero-portaria" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pmam-accent focus:border-pmam-accent"
                               placeholder="Ex: 05.02/2024/SD/SJD/PMAM">
                        <div class="text-sm text-gray-500 mt-2">
                            Este número será utilizado em todos os documentos gerados
                        </div>
                    </div>
                    
                    <!-- Data da Portaria -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3">Data da Portaria</h3>
                        <div class="grid grid-cols-3 gap-2">
                            <input type="number" id="data-dia" min="1" max="31" 
                                   class="p-3 border border-gray-300 rounded-lg text-center"
                                   placeholder="Dia">
                            <input type="text" id="data-mes" 
                                   class="p-3 border border-gray-300 rounded-lg"
                                   placeholder="Mês">
                            <input type="number" id="data-ano" min="2000" max="2100"
                                   class="p-3 border border-gray-300 rounded-lg text-center"
                                   placeholder="Ano">
                        </div>
                    </div>
                    
                    <!-- Local -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3">Local/Unidade</h3>
                        <input type="text" id="local-unidade" 
                               class="w-full p-3 border border-gray-300 rounded-lg"
                               placeholder="Ex: SJD do Comando de Policiamento Leste">
                    </div>
                    
                    <!-- Encarregado/Sindicante -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3">Encarregado/Sindicante</h3>
                        <input type="text" id="encarregado-nome" 
                               class="w-full p-3 border border-gray-300 rounded-lg"
                               placeholder="Nome, Posto/Grad e CI">
                        <input type="text" id="encarregado-cargo" 
                               class="w-full p-3 border border-gray-300 rounded-lg mt-2"
                               placeholder="Cargo/Função">
                    </div>
                    
                    <!-- Acusado/Indiciado -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3" id="titulo-acusado">Acusado/Sindicado</h3>
                        <input type="text" id="acusado-nome" 
                               class="w-full p-3 border border-gray-300 rounded-lg"
                               placeholder="Nome, Posto/Grad e CI">
                        <input type="text" id="acusado-lotacao" 
                               class="w-full p-3 border border-gray-300 rounded-lg mt-2"
                               placeholder="Lotação/Unidade">
                    </div>
                    
                    <!-- Ofendido/Vítima -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3">Ofendido/Vítima</h3>
                        <select id="ofendido-tipo" class="w-full p-3 border border-gray-300 rounded-lg mb-2">
                            <option value="PMAM">Polícia Militar do Amazonas</option>
                            <option value="FAZENDA">Fazenda Pública/PMAM</option>
                            <option value="PARTICULAR">Particular</option>
                        </select>
                        <input type="text" id="ofendido-nome" 
                               class="w-full p-3 border border-gray-300 rounded-lg"
                               placeholder="Nome ou entidade ofendida">
                    </div>
                    
                    <!-- Objeto da Apuração -->
                    <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-pmam-blue mb-3">Objeto da Apuração</h3>
                        <textarea id="objeto-apuracao" rows="3"
                                  class="w-full p-3 border border-gray-300 rounded-lg"
                                  placeholder="Descreva sucintamente o objeto do procedimento..."></textarea>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200">
                    <button onclick="sistema.voltarParaProcedimento()" 
                            class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Voltar
                    </button>
                    <button onclick="sistema.avancarParaDocumentos()" 
                            class="bg-pmam-accent text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                        Avançar para Documentos
                        <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Aba 3: Documentos -->
        <div id="content-documentos" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-pmam-blue mb-4">
                    <i class="fas fa-file-alt mr-2"></i>
                    Documentos do Procedimento
                </h2>
                
                <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <button onclick="sistema.selecionarDocumento('autuacao')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-file-signature text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">AUTUAÇÃO</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('abertura')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-folder-open text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">ABERTURA</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('designacao')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-user-tie text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">DESIGNAÇÃO</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('termos')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-gavel text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">TERMOS</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('oficios')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-envelope text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">OFÍCIOS</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('certidoes')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-certificate text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">CERTIDÕES</div>
                    </button>
                    
                    <button onclick="sistema.selecionarDocumento('relatorio')" 
                            class="doc-btn p-4 border rounded-lg text-center hover:border-pmam-accent hover:bg-blue-50 transition-colors">
                        <i class="fas fa-file-contract text-2xl text-pmam-blue mb-2"></i>
                        <div class="font-medium">RELATÓRIO</div>
                    </button>
                </div>
                
                <!-- Formulário dinâmico do documento selecionado -->
                <div id="formulario-documento" class="hidden bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 id="titulo-documento-selecionado" class="text-lg font-bold text-pmam-blue mb-4"></h3>
                    <div id="campos-documento"></div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200">
                    <button onclick="sistema.voltarParaCaracterizacao()" 
                            class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Voltar
                    </button>
                    <button onclick="sistema.avancarParaPreview()" 
                            class="bg-pmam-accent text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                        Visualizar Documento
                        <i class="fas fa-eye ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Aba 4: Preview -->
        <div id="content-preview" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-pmam-blue mb-4">
                    <i class="fas fa-eye mr-2"></i>
                    Pré-visualização do Documento
                </h2>
                
                <div class="mb-4 flex justify-between items-center">
                    <div>
                        <span class="font-medium text-pmam-blue" id="preview-tipo-procedimento"></span>
                        <span class="mx-2">•</span>
                        <span class="font-medium" id="preview-tipo-documento"></span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="sistema.voltarParaDocumentos()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-edit mr-1"></i> Editar
                        </button>
                        <button onclick="sistema.gerarPDF()" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-file-pdf mr-1"></i> Gerar PDF
                        </button>
                        <button onclick="sistema.copiarTexto()" 
                                class="px-4 py-2 bg-pmam-blue text-white rounded-lg hover:bg-blue-800">
                            <i class="fas fa-copy mr-1"></i> Copiar
                        </button>
                    </div>
                </div>
                
                <div id="preview-conteudo" class="preview-doc p-6 rounded-lg min-h-[500px] overflow-auto">
                    Selecione e preencha um documento para visualizar aqui...
                </div>
                
                <div class="mt-6 pt-6 border-t border-gray-200 flex justify-between">
                    <button onclick="sistema.voltarParaDocumentos()" 
                            class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Voltar para Documentos
                    </button>
                    <button onclick="sistema.novoDocumento()" 
                            class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        <i class="fas fa-plus mr-2"></i>
                        Novo Documento
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;
        
        class SistemaProcedimentos {
            constructor() {
                this.procedimentoSelecionado = null;
                this.documentoSelecionado = null;
                this.dadosCaracterizacao = {};
                this.definirModelos();
                this.preencherDataAtual();
            }
            
            definirModelos() {
                this.modelosDocumentos = {
                    autuacao: {
                        titulo: "AUTUAÇÃO",
                        campos: [
                            { id: 'escri��o_nome', label: 'Escrivão Designado', tipo: 'text' }
                        ],
                        template: (dados) => `
                            ${dados.procedimento.nome.toUpperCase()}
                            
                            ENCARREGADO: ${dados.encarregado.nome}
                            ACUSADO: ${dados.acusado.nome}
                            OFENDIDO: ${dados.ofendido.nome}
                            
                            A U T U A Ç Ã O
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, nesta cidade de Manaus, Estado do Amazonas, na ${dados.local.unidade}, autuo a Portaria nº ${dados.portaria.numero}, datada de ${dados.portaria.data}, e demais documentos que a este junto, do que para constar, lavro o presente termo. Eu, ${dados.encarregado.nome}, Encarregado que o digitei e assino.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado / Sindicante
                        `
                    },
                    
                    abertura: {
                        titulo: "TERMO DE ABERTURA",
                        campos: [],
                        template: (dados) => `
                            TERMO DE ABERTURA
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, nesta cidade de Manaus, Estado do Amazonas, na ${dados.local.unidade}, dei início ao presente ${dados.procedimento.nome.toUpperCase()}, tendo como objeto: ${dados.objeto.apuracao}. Do que para constar lavro o presente Termo que o escrevi e assino.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado / Sindicante
                        `
                    },
                    
                    designacao: {
                        titulo: "DESIGNAÇÃO DE ESCRIVÃO",
                        campos: [
                            { id: 'escrivao_designado', label: 'Nome e Posto/Grad do Escrivão', tipo: 'text' }
                        ],
                        template: (dados) => `
                            TERMO DE DESIGNAÇÃO DE ESCRIVÃO
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, eu, ${dados.encarregado.nome}, Encarregado, RESOLVO:
                            
                            DESIGNAR o ${dados.campos.escrivao_designado || '____________________'}, para exercer a função de **Escrivão** no presente ${dados.procedimento.nome.toUpperCase()} acima referenciado, devendo cumprir todas as determinações legais inerentes ao cargo.
                            
                            Para constar, lavro o presente termo que vai assinado.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado / Sindicante
                        `
                    },
                    
                    termos: {
                        titulo: "TERMO DE DECLARAÇÃO",
                        campos: [
                            { id: 'tipo_declaracao', label: 'Tipo de Declaração', tipo: 'select', 
                              opcoes: ['Testemunha', 'Acusado', 'Vítima'] },
                            { id: 'declarante_nome', label: 'Nome do Declarante', tipo: 'text' },
                            { id: 'depoimento', label: 'Depoimento', tipo: 'textarea' }
                        ],
                        template: (dados) => `
                            TERMO DE DECLARAÇÃO - ${(dados.campos.tipo_declaracao || 'TESTEMUNHA').toUpperCase()}
                            
                            AUTOS: ${dados.procedimento.nome.toUpperCase()} (${dados.procedimento.id}) nº ${dados.portaria.numero}
                            ENCARREGADO: ${dados.encarregado.nome}
                            
                            DECLARANTE: ${dados.campos.declarante_nome || '____________________'}
                            
                            Aos ${dados.data.dia} dias do mês de ${dados.data.mes} do ano de ${dados.data.ano}, nesta Cidade de Manaus, Estado do Amazonas, na ${dados.local.unidade}, perante o Encarregado, presente o Escrivão, foi inquirido o(a) declarante acima qualificado(a), que ao ser perguntado(a) sobre o objeto da apuração, declarou:
                            
                            ${dados.campos.depoimento || '____________________'}
                            
                            Lida e achada conforme, dou por encerrado o presente Termo, que segue assinado.
                            
                            Manaus-AM, ${dados.data.dia} de ${dados.data.mes} de ${dados.data.ano}.
                            
                            __________________________________
                            ${dados.campos.declarante_nome || '____________________'}
                            Declarante
                            
                            __________________________________
                            [NOME DO ESCRIVÃO]
                            Escrivão
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado
                        `
                    },
                    
                    oficios: {
                        titulo: "OFÍCIO",
                        campos: [
                            { id: 'destinatario', label: 'Destinatário', tipo: 'text' },
                            { id: 'assunto', label: 'Assunto', tipo: 'text' },
                            { id: 'conteudo', label: 'Conteúdo', tipo: 'textarea' }
                        ],
                        template: (dados) => `
                            OFÍCIO Nº XXX/${dados.data.ano}/${dados.procedimento.id}
                            Quartel em Manaus/AM, ${dados.data.dia} de ${dados.data.mes} de ${dados.data.ano}.
                            
                            Ao ${dados.campos.destinatario || '____________________'}
                            
                            Assunto: ${dados.campos.assunto || '____________________'}
                            
                            Senhor(a),
                            
                            ${dados.campos.conteudo || '____________________'}
                            
                            Atenciosamente,
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            Encarregado
                        `
                    },
                    
                    relatorio: {
                        titulo: "RELATÓRIO",
                        campos: [
                            { id: 'historico', label: 'Histórico', tipo: 'textarea' },
                            { id: 'diligencias', label: 'Diligências Realizadas', tipo: 'textarea' },
                            { id: 'analise', label: 'Análise', tipo: 'textarea' },
                            { id: 'conclusao', label: 'Conclusão', tipo: 'textarea' }
                        ],
                        template: (dados) => `
                            RELATÓRIO DO ${dados.procedimento.nome.toUpperCase()} (${dados.procedimento.id})
                            
                            Nº DO PROCEDIMENTO: ${dados.portaria.numero}
                            ENCARREGADO: ${dados.encarregado.nome}
                            ACUSADO: ${dados.acusado.nome}
                            
                            1. HISTÓRICO / PREAMBULAR
                            
                            ${dados.campos.historico || '____________________'}
                            
                            2. DILIGÊNCIAS REALIZADAS
                            
                            ${dados.campos.diligencias || '____________________'}
                            
                            3. ANÁLISE E FUNDAMENTAÇÃO
                            
                            ${dados.campos.analise || '____________________'}
                            
                            4. CONCLUSÃO E PROPOSTA
                            
                            ${dados.campos.conclusao || '____________________'}
                            
                            Manaus-AM, ${dados.data.dia} de ${dados.data.mes} de ${dados.data.ano}.
                            
                            __________________________________
                            ${dados.encarregado.nome}
                            ENCARREGADO
                        `
                    }
                };
            }
            
            selecionarProcedimento(tipo) {
                const procedimentos = {
                    SD: { id: 'SD', nome: 'SINDICÂNCIA DISCIPLINAR' },
                    SI: { id: 'SI', nome: 'SINDICÂNCIA INVESTIGATIVA' },
                    IPM: { id: 'IPM', nome: 'INQUÉRITO POLICIAL MILITAR' },
                    PAD: { id: 'PAD', nome: 'PROCESSO ADMINISTRATIVO DISCIPLINAR' },
                    PARE: { id: 'PARE', nome: 'PROCEDIMENTO DE RESSARCIMENTO' }
                };
                
                this.procedimentoSelecionado = procedimentos[tipo];
                
                // Atualizar interface
                document.getElementById('procedimento-nome').textContent = 
                    `${this.procedimentoSelecionado.id} - ${this.procedimentoSelecionado.nome}`;
                
                let descricao = '';
                switch(tipo) {
                    case 'SD': descricao = 'Para apuração de infrações disciplinares cometidas por militares.'; break;
                    case 'SI': descricao = 'Para investigação de fatos que possam configurar infrações disciplinares ou penais.'; break;
                    case 'IPM': descricao = 'Para investigação de infrações penais militares.'; break;
                    case 'PAD': descricao = 'Processo formal para apuração de infrações disciplinares graves.'; break;
                    case 'PARE': descricao = 'Para apuração de responsabilidade civil por danos à fazenda pública.'; break;
                }
                document.getElementById('procedimento-descricao').textContent = descricao;
                
                // Atualizar título do acusado para PARE
                if (tipo === 'PARE') {
                    document.getElementById('titulo-acusado').textContent = 'Indiciado/Responsável';
                } else {
                    document.getElementById('titulo-acusado').textContent = 'Acusado/Sindicado';
                }
                
                document.getElementById('info-procedimento-selecionado').classList.remove('hidden');
                
                // Destacar card selecionado
                document.querySelectorAll('.procedimento-card').forEach(card => {
                    card.classList.remove('border-pmam-accent', 'bg-blue-50');
                });
                event.currentTarget.classList.add('border-pmam-accent', 'bg-blue-50');
            }
            
            avancarParaCaracterizacao() {
                if (!this.procedimentoSelecionado) {
                    this.mostrarToast('Selecione um tipo de procedimento primeiro.', 'erro');
                    return;
                }
                
                // Atualizar abas
                this.ativarAba('caracterizacao');
                
                // Atualizar info do procedimento
                document.getElementById('procedimento-atual-info').textContent = 
                    `${this.procedimentoSelecionado.id} - ${this.procedimentoSelecionado.nome}`;
                
                // Preencher número da portaria com padrão
                const ano = document.getElementById('data-ano').value;
                const numeroPadrao = `XX.XX/${ano}/${this.procedimentoSelecionado.id}/SJD/PMAM`;
                document.getElementById('numero-portaria').value = numeroPadrao;
            }
            
            voltarParaProcedimento() {
                this.ativarAba('procedimento');
            }
            
            avancarParaDocumentos() {
                // Coletar dados da caracterização
                this.dadosCaracterizacao = {
                    procedimento: this.procedimentoSelecionado,
                    portaria: {
                        numero: document.getElementById('numero-portaria').value,
                        data: `${document.getElementById('data-dia').value} de ${document.getElementById('data-mes').value} de ${document.getElementById('data-ano').value}`
                    },
                    data: {
                        dia: document.getElementById('data-dia').value,
                        mes: document.getElementById('data-mes').value,
                        ano: document.getElementById('data-ano').value
                    },
                    local: {
                        unidade: document.getElementById('local-unidade').value
                    },
                    encarregado: {
                        nome: document.getElementById('encarregado-nome').value,
                        cargo: document.getElementById('encarregado-cargo').value
                    },
                    acusado: {
                        nome: document.getElementById('acusado-nome').value,
                        lotacao: document.getElementById('acusado-lotacao').value
                    },
                    ofendido: {
                        tipo: document.getElementById('ofendido-tipo').value,
                        nome: document.getElementById('ofendido-nome').value
                    },
                    objeto: {
                        apuracao: document.getElementById('objeto-apuracao').value
                    }
                };
                
                this.ativarAba('documentos');
            }
            
            voltarParaCaracterizacao() {
                this.ativarAba('caracterizacao');
            }
            
            selecionarDocumento(tipo) {
                this.documentoSelecionado = tipo;
                const modelo = this.modelosDocumentos[tipo];
                
                // Atualizar interface
                document.getElementById('titulo-documento-selecionado').textContent = modelo.titulo;
                document.getElementById('formulario-documento').classList.remove('hidden');
                
                // Gerar campos
                const container = document.getElementById('campos-documento');
                container.innerHTML = '';
                
                modelo.campos.forEach(campo => {
                    const div = document.createElement('div');
                    div.className = 'mb-4';
                    
                    let input = '';
                    if (campo.tipo === 'textarea') {
                        input = `<textarea id="doc-${campo.id}" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="${campo.label}"></textarea>`;
                    } else if (campo.tipo === 'select') {
                        const opcoes = campo.opcoes.map(op => `<option value="${op}">${op}</option>`).join('');
                        input = `<select id="doc-${campo.id}" class="w-full p-3 border border-gray-300 rounded-lg">${opcoes}</select>`;
                    } else {
                        input = `<input type="text" id="doc-${campo.id}" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="${campo.label}">`;
                    }
                    
                    div.innerHTML = `
                        <label class="block mb-2 font-medium text-gray-700">${campo.label}:</label>
                        ${input}
                    `;
                    
                    container.appendChild(div);
                });
                
                // Destacar botão selecionado
                document.querySelectorAll('.doc-btn').forEach(btn => {
                    btn.classList.remove('border-pmam-accent', 'bg-blue-50');
                });
                event.currentTarget.classList.add('border-pmam-accent', 'bg-blue-50');
            }
            
            avancarParaPreview() {
                if (!this.documentoSelecionado) {
                    this.mostrarToast('Selecione um tipo de documento.', 'erro');
                    return;
                }
                
                // Coletar dados dos campos do documento
                const campos = {};
                const modelo = this.modelosDocumentos[this.documentoSelecionado];
                
                modelo.campos.forEach(campo => {
                    const elemento = document.getElementById(`doc-${campo.id}`);
                    if (elemento) {
                        campos[campo.id] = elemento.value;
                    }
                });
                
                // Combinar dados
                const dadosCompletos = {
                    ...this.dadosCaracterizacao,
                    campos: campos
                };
                
                // Gerar preview
                const conteudo = modelo.template(dadosCompletos);
                document.getElementById('preview-conteudo').textContent = conteudo;
                
                // Atualizar info
                document.getElementById('preview-tipo-procedimento').textContent = 
                    `${this.procedimentoSelecionado.id} - ${this.documentoSelecionado.toUpperCase()}`;
                document.getElementById('preview-tipo-documento').textContent = 
                    modelo.titulo;
                
                this.ativarAba('preview');
            }
            
            voltarParaDocumentos() {
                this.ativarAba('documentos');
            }
            
            ativarAba(aba) {
                // Atualizar abas
                ['procedimento', 'caracterizacao', 'documentos', 'preview'].forEach(tab => {
                    const tabBtn = document.getElementById(`tab-${tab}`);
                    const content = document.getElementById(`content-${tab}`);
                    
                    if (tab === aba) {
                        tabBtn.classList.add('active');
                        tabBtn.disabled = false;
                        content.classList.remove('hidden');
                    } else {
                        tabBtn.classList.remove('active');
                        content.classList.add('hidden');
                        
                        // Habilitar/desabilitar abas conforme progresso
                        if (tab === 'caracterizacao' && this.procedimentoSelecionado) {
                            tabBtn.disabled = false;
                        } else if (tab === 'documentos' && this.dadosCaracterizacao.procedimento) {
                            tabBtn.disabled = false;
                        } else if (tab === 'preview' && this.documentoSelecionado) {
                            tabBtn.disabled = false;
                        } else if (tab !== 'procedimento') {
                            tabBtn.disabled = true;
                        }
                    }
                });
            }
            
            preencherDataAtual() {
                const hoje = new Date();
                const meses = [
                    'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                ];
                
                document.getElementById('data-dia').value = hoje.getDate();
                document.getElementById('data-mes').value = meses[hoje.getMonth()];
                document.getElementById('data-ano').value = hoje.getFullYear();
            }
            
            gerarPDF() {
                if (!this.documentoSelecionado) return;
                
                const conteudo = document.getElementById('preview-conteudo').textContent;
                const doc = new jsPDF();
                
                doc.setFont('helvetica');
                doc.setFontSize(11);
                
                const margem = 20;
                const largura = 210 - 2 * margem;
                
                const linhas = doc.splitTextToSize(conteudo, largura);
                doc.text(linhas, margem, margem);
                
                const nomeArquivo = `${this.procedimentoSelecionado.id}_${this.documentoSelecionado}_${new Date().getTime()}.pdf`;
                doc.save(nomeArquivo);
                
                this.mostrarToast('PDF gerado com sucesso!', 'sucesso');
            }
            
            copiarTexto() {
                const texto = document.getElementById('preview-conteudo').textContent;
                navigator.clipboard.writeText(texto)
                    .then(() => this.mostrarToast('Texto copiado para a área de transferência!', 'sucesso'))
                    .catch(() => this.mostrarToast('Erro ao copiar texto.', 'erro'));
            }
            
            novoDocumento() {
                this.documentoSelecionado = null;
                this.ativarAba('documentos');
                document.getElementById('formulario-documento').classList.add('hidden');
                document.querySelectorAll('.doc-btn').forEach(btn => {
                    btn.classList.remove('border-pmam-accent', 'bg-blue-50');
                });
            }
            
            mostrarToast(mensagem, tipo) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                let cor = 'bg-blue-500';
                let icone = 'fas fa-info-circle';
                
                if (tipo === 'sucesso') {
                    cor = 'bg-green-500';
                    icone = 'fas fa-check-circle';
                } else if (tipo === 'erro') {
                    cor = 'bg-red-500';
                    icone = 'fas fa-exclamation-circle';
                }
                
                toast.className = `${cor} text-white p-4 rounded-lg shadow-lg mb-2 flex items-center`;
                toast.innerHTML = `
                    <i class="${icone} mr-3"></i>
                    <span>${mensagem}</span>
                `;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => container.removeChild(toast), 300);
                }, 3000);
            }
        }
        
        // Inicializar sistema
        const sistema = new SistemaProcedimentos();
    </script>
</body>
</html>
