<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISPRO - PMAM | Sistema de Procedimentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        // CONFIGURAÇÃO DO SUPABASE (INSIRA SUAS CHAVES AQUI)
        const SUPABASE_URL = 'https://dzknjtstiptcbkvszibo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6a25qdHN0aXB0Y2JrdnN6aWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTU3NDYsImV4cCI6MjA4MTQ3MTc0Nn0.LN4j37EHqLQpdoS0mNAIW9v-MTgWo8nXoFl1FrhSSHE';
        
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pmam-blue': '#1e3a8a',
                        'pmam-navy': '#0f172a',
                        'pmam-light': '#3b82f6',
                        'pmam-accent': '#0ea5e9',
                        'pmam-gold': '#D4AF37',
                        'pmam-gold-dark': '#B8941F',
                        'pmam-success': '#10b981',
                        'pmam-warning': '#f59e0b',
                        'pmam-error': '#ef4444',
                        'pmam-surface': '#f8fafc',
                        'pmam-card': '#ffffff',
                        'pmam-border': '#e2e8f0',
                        'pmam-text': '#334155',
                        'pmam-muted': '#64748b',
                        'pmam-dark': '#1e293b',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'slide-in': 'slideIn 0.4s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(20px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                    },
                    boxShadow: {
                        'pmam-lg': '0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'pmam-xl': '0 20px 40px -10px rgba(0, 0, 0, 0.1)',
                    },
                }
            }
        }
    </script>
    
    <style>
        body {
            font-feature-settings: "kern", "liga", "clig", "calt";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .header-logo {
            height: 120px;
            width: auto;
            filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: scale(1.05);
        }
        
        .step-bar { display: flex; justify-content: space-between; position: relative; margin-bottom: 3rem; }
        .step-bar::before { content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 2px; background: #cbd5e1; z-index: 0; }
        .step-item { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; flex: 1; }
        .step-circle { width: 40px; height: 40px; border-radius: 50%; background: #cbd5e1; color: #64748b; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-bottom: 0.5rem; transition: all 0.3s ease; }
        .step-item.active .step-circle { background: linear-gradient(135deg, #D4AF37, #FFD700); color: #000; box-shadow: 0 0 20px rgba(212, 175, 55, 0.5); }
        .step-item.completed .step-circle { background: #10b981; color: white; }
        .step-label { font-size: 0.75rem; color: #64748b; text-align: center; font-weight: 500; }
        .step-item.active .step-label { color: #1e3a8a; font-weight: 600; }
        .card-procedimento { transition: all 0.3s ease; border: 2px solid transparent; cursor: pointer; }
        .card-procedimento:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); border-color: #D4AF37; }
        .doc-card { transition: all 0.3s ease; border: 2px solid #e2e8f0; cursor: pointer; }
        .doc-card:hover { border-color: #D4AF37; transform: translateY(-3px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2); }
        .doc-card.generated { border-color: #10b981; background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%); }
        .input-field { transition: all 0.3s ease; }
        .input-field:focus { outline: none; border-color: #D4AF37; box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1); }
        .btn-gold { background: linear-gradient(135deg, #D4AF37, #FFD700); color: #000; font-weight: 600; transition: all 0.3s ease; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .sidebar { width: 280px; transition: transform 0.3s ease; z-index: 40; }
        .main-content { margin-left: 280px; transition: margin 0.3s ease; }
        
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); position: fixed; left: 0; height: 100vh; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
        }
        
        .persona-card { border: 2px solid #e2e8f0; transition: all 0.3s ease; }
        .persona-card:hover { border-color: #D4AF37; transform: translateY(-2px); }
        .persona-card.selected { border-color: #10b981; background-color: #f0fff4; }
        
        .status-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-ativo { background-color: #10b981; color: white; }
        .status-concluido { background-color: #3b82f6; color: white; }
        .status-arquivado { background-color: #6b7280; color: white; }
    </style>
</head>
<body class="text-pmam-text font-sans">
    
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar bg-white border-r border-pmam-border fixed top-0 left-0 h-full overflow-y-auto custom-scrollbar shadow-2xl">
        <div class="p-6 border-b border-pmam-border flex flex-col items-center">
            <div class="logo-container">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-pmam-blue to-pmam-navy flex items-center justify-center shadow-lg">
                    <i class="fas fa-shield-alt text-white text-xl"></i>
                </div>
                <div class="text-center">
                    <h2 class="text-xl font-black text-pmam-navy tracking-tighter">SISPRO - PMAM</h2>
                    <p class="text-[10px] text-pmam-muted uppercase font-bold tracking-widest">Procedimentos Oficiais</p>
                </div>
            </div>
        </div>
        
        <div class="p-6 border-b border-pmam-border">
            <h3 class="font-semibold text-pmam-navy mb-4 text-xs uppercase tracking-widest">Status Atual</h3>
            <div class="space-y-4">
                <div class="step-item" id="sidebar-step-1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Tipo de Procedimento</div>
                    <div id="step-1-info" class="text-[10px] text-pmam-muted mt-1 text-center font-bold uppercase">Não selecionado</div>
                </div>
                <div class="step-item" id="sidebar-step-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Caracterização</div>
                    <div id="step-2-info" class="text-[10px] text-pmam-muted mt-1 text-center font-bold uppercase tracking-tighter">Aguardando</div>
                </div>
                <div class="step-item" id="sidebar-step-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Documentos</div>
                    <div id="step-3-info" class="text-[10px] text-pmam-muted mt-1 text-center font-bold uppercase">0 Seções</div>
                </div>
            </div>
        </div>
        
        <div class="p-6">
            <h3 class="font-semibold text-pmam-navy mb-4 text-xs uppercase">Documentos Atuais</h3>
            <div id="lista-documentos-sidebar" class="space-y-2">
                <div class="text-xs text-pmam-muted text-center italic">Nenhum documento gerado</div>
            </div>
        </div>
        
        <div class="p-6 border-t border-pmam-border">
            <button onclick="sistema.carregarDoBanco()" class="w-full px-4 py-2 bg-pmam-blue text-white rounded-lg hover:bg-blue-700 text-xs font-bold transition-all flex items-center justify-center gap-2">
                <i class="fas fa-database"></i> CARREGAR DO BANCO
            </button>
        </div>
    </div>
    
    <!-- Toggle para Mobile -->
    <button id="sidebar-toggle" class="lg:hidden fixed top-4 left-4 z-50 p-2 bg-pmam-navy text-white rounded-lg shadow-lg border border-pmam-gold">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Conteúdo Principal -->
    <div class="main-content min-h-screen bg-slate-50">
        <header class="bg-white border-b border-pmam-border sticky top-0 z-30 shadow-sm">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-lg font-bold text-pmam-navy leading-none">SISPRO - Sistema de Procedimentos</h1>
                        <p class="text-xs text-pmam-muted mt-1">Polícia Militar do Amazonas</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="sistema.salvarNoBanco()" class="px-4 py-2 bg-pmam-success text-white rounded-lg hover:bg-emerald-600 text-xs font-bold transition-all flex items-center gap-2 shadow-md">
                            <i class="fas fa-cloud-upload-alt"></i> SALVAR NO BANCO
                        </button>
                        <button onclick="sistema.abrirGerenciador()" class="px-4 py-2 bg-pmam-navy text-white rounded-lg hover:bg-black text-xs font-bold transition-all flex items-center gap-2">
                            <i class="fas fa-search"></i> CONSULTAR BANCO
                        </button>
                        <button onclick="sistema.novoProcedimento()" class="px-4 py-2 bg-pmam-gold text-black rounded-lg hover:bg-yellow-500 text-xs font-bold transition-all flex items-center gap-2">
                            <i class="fas fa-plus"></i> NOVO
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Barra de Progresso -->
        <div class="container mx-auto px-4 py-6">
            <div class="step-bar max-w-4xl mx-auto mb-8">
                <div class="step-item active" id="step-indicator-1">
                    <div class="step-circle">1</div>
                    <div class="step-label text-[10px] uppercase font-bold">Tipo</div>
                </div>
                <div class="step-item" id="step-indicator-2">
                    <div class="step-circle">2</div>
                    <div class="step-label text-[10px] uppercase font-bold">Dados</div>
                </div>
                <div class="step-item" id="step-indicator-3">
                    <div class="step-circle">3</div>
                    <div class="step-label text-[10px] uppercase font-bold">Documentos</div>
                </div>
            </div>
        </div>
        
        <!-- TELA 1: Seleção do Tipo de Procedimento -->
        <div id="tela-1" class="animate-fadeIn">
            <div class="container mx-auto px-4 py-8">
                <div class="text-center mb-10">
                    <h2 class="text-2xl font-black text-pmam-navy mb-2">INICIAR NOVO PROCEDIMENTO</h2>
                    <p class="text-pmam-muted text-sm uppercase tracking-widest font-bold">Selecione a categoria abaixo</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                    <!-- SAD -->
                    <div onclick="sistema.selecionarProcedimento('SAD')" class="card-procedimento bg-white rounded-2xl p-6 shadow-pmam-lg border border-slate-100">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-pmam-blue flex items-center justify-center shadow-lg">
                                <i class="fas fa-gavel text-white text-xl"></i>
                            </div>
                            <span class="text-[9px] font-black bg-blue-100 text-blue-700 px-3 py-1 rounded-full uppercase">Disciplinar</span>
                        </div>
                        <h3 class="text-lg font-bold text-pmam-navy mb-1 uppercase">SAD</h3>
                        <p class="text-[11px] text-pmam-muted font-medium">Sindicância Administrativa Disciplinar</p>
                    </div>

                    <!-- IPM -->
                    <div onclick="sistema.selecionarProcedimento('IPM')" class="card-procedimento bg-white rounded-2xl p-6 shadow-pmam-lg border border-slate-100">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-red-600 flex items-center justify-center shadow-lg">
                                <i class="fas fa-shield-alt text-white text-xl"></i>
                            </div>
                            <span class="text-[9px] font-black bg-red-100 text-red-700 px-3 py-1 rounded-full uppercase">Penal Militar</span>
                        </div>
                        <h3 class="text-lg font-bold text-pmam-navy mb-1 uppercase">IPM</h3>
                        <p class="text-[11px] text-pmam-muted font-medium">Inquérito Policial Militar</p>
                    </div>

                    <!-- SINDINVEST -->
                    <div onclick="sistema.selecionarProcedimento('SINDINVEST')" class="card-procedimento bg-white rounded-2xl p-6 shadow-pmam-lg border border-slate-100">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-purple-600 flex items-center justify-center shadow-lg">
                                <i class="fas fa-search text-white text-xl"></i>
                            </div>
                            <span class="text-[9px] font-black bg-purple-100 text-purple-700 px-3 py-1 rounded-full uppercase">Investigativo</span>
                        </div>
                        <h3 class="text-lg font-bold text-pmam-navy mb-1 uppercase">SINDINVEST</h3>
                        <p class="text-[11px] text-pmam-muted font-medium">Sindicância Investigativa</p>
                    </div>
                </div>

                <div id="procedimento-selecionado-info" class="hidden mt-10 max-w-4xl mx-auto bg-pmam-navy rounded-2xl p-8 border-b-4 border-pmam-gold shadow-2xl">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                        <div class="flex items-center gap-4">
                            <div id="procedimento-icon" class="w-16 h-16 rounded-2xl bg-white/10 flex items-center justify-center border border-white/20">
                                <i class="fas text-pmam-gold text-2xl"></i>
                            </div>
                            <div>
                                <h3 id="procedimento-nome" class="text-xl font-black text-white uppercase tracking-tight"></h3>
                                <p id="procedimento-descricao" class="text-xs text-slate-400 font-bold uppercase tracking-widest"></p>
                            </div>
                        </div>
                        <button onclick="sistema.avancarParaCaracterizacao()" class="btn-gold px-10 py-4 rounded-xl text-sm font-black flex items-center gap-3">
                            AVANÇAR <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TELA 2: Caracterização -->
        <div id="tela-2" class="hidden animate-fadeIn">
            <div class="container mx-auto px-4 py-8">
                <div class="max-w-5xl mx-auto">
                    <!-- Dados Básicos -->
                    <div class="bg-white rounded-2xl border border-pmam-border p-8 shadow-pmam-xl mb-8">
                        <h3 class="text-lg font-black text-pmam-navy mb-6 uppercase border-b pb-3">DADOS BÁSICOS DO PROCEDIMENTO</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-xs font-black text-pmam-navy mb-2 uppercase">Nº Portaria*</label>
                                    <input type="text" id="numero-portaria" class="input-field w-full p-3 border border-pmam-border rounded-lg text-sm font-bold" placeholder="Ex: 001/2024-CJD/PMAM">
                                </div>
                                <div>
                                    <label class="block text-xs font-black text-pmam-navy mb-2 uppercase">Data da Portaria*</label>
                                    <div class="grid grid-cols-3 gap-2">
                                        <input type="number" id="data-dia" placeholder="Dia" class="input-field p-3 border rounded-lg text-center text-sm font-bold" min="1" max="31">
                                        <input type="text" id="data-mes" placeholder="Mês" class="input-field p-3 border rounded-lg text-center text-sm font-bold uppercase">
                                        <input type="number" id="data-ano" placeholder="Ano" class="input-field p-3 border rounded-lg text-center text-sm font-bold" min="2000" max="2100">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-black text-pmam-navy mb-2 uppercase">Local/Unidade*</label>
                                    <input type="text" id="local-unidade" class="input-field w-full p-3 border rounded-lg text-sm font-bold" placeholder="Ex: CPA Oeste, Manaus-AM">
                                </div>
                            </div>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-xs font-black text-pmam-navy mb-2 uppercase">Objeto da Apuração*</label>
                                    <textarea id="objeto-apuracao" rows="3" class="input-field w-full p-3 border rounded-lg text-sm font-bold resize-none" placeholder="Descreva o objeto do procedimento..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-xs font-black text-pmam-navy mb-2 uppercase">Status do Procedimento</label>
                                    <select id="status-procedimento" class="input-field w-full p-3 border rounded-lg text-sm font-bold">
                                        <option value="ativo">ATIVO</option>
                                        <option value="concluido">CONCLUÍDO</option>
                                        <option value="arquivado">ARQUIVADO</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Qualificação dos Envolvidos -->
                    <div class="bg-white rounded-2xl border border-pmam-border p-8 shadow-pmam-xl mb-8">
                        <h3 class="text-lg font-black text-pmam-navy mb-6 uppercase border-b pb-3">QUALIFICAÇÃO DOS ENVOLVIDOS</h3>
                        
                        <!-- Encarregado/Sindicante -->
                        <div class="mb-8">
                            <h4 class="text-sm font-black text-pmam-navy mb-4 uppercase flex items-center gap-2">
                                <i class="fas fa-user-tie text-pmam-gold"></i>
                                ENCARREGADO / SINDICANTE
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Posto/Graduação</label>
                                    <input type="text" id="encarregado-posto" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Ex: MAJ QOPM">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Nome Completo</label>
                                    <input type="text" id="encarregado-nome" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Nome completo">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">CI/Identificação</label>
                                    <input type="text" id="encarregado-ci" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Ex: 15974">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Unidade</label>
                                    <input type="text" id="encarregado-unidade" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Unidade de lotação">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Escrivão -->
                        <div class="mb-8">
                            <h4 class="text-sm font-black text-pmam-navy mb-4 uppercase flex items-center gap-2">
                                <i class="fas fa-pen-fancy text-pmam-gold"></i>
                                ESCRIVÃO
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Posto/Graduação</label>
                                    <input type="text" id="escrivao-posto" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Ex: 1º TEN QOPM">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Nome Completo</label>
                                    <input type="text" id="escrivao-nome" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Nome completo">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">CI/Identificação</label>
                                    <input type="text" id="escrivao-ci" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Ex: 20892">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Indicado/Investigado -->
                        <div class="mb-8">
                            <h4 class="text-sm font-black text-pmam-navy mb-4 uppercase flex items-center gap-2">
                                <i class="fas fa-user-shield text-pmam-gold"></i>
                                INDICIADO / INVESTIGADO
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Posto/Graduação</label>
                                    <input type="text" id="indicado-posto" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Ex: 1º TEN QOPM">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Nome Completo</label>
                                    <input type="text" id="indicado-nome" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Nome completo">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">CI/Identificação</label>
                                    <input type="text" id="indicado-ci" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Ex: 20943">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Unidade</label>
                                    <input type="text" id="indicado-unidade" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Unidade de lotação">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ofendido/Vítima -->
                        <div>
                            <h4 class="text-sm font-black text-pmam-navy mb-4 uppercase flex items-center gap-2">
                                <i class="fas fa-user-injured text-pmam-gold"></i>
                                OFENDIDO / VÍTIMA
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Nome Completo</label>
                                    <input type="text" id="ofendido-nome" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Nome completo">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">RG</label>
                                    <input type="text" id="ofendido-rg" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Número do RG">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">CPF</label>
                                    <input type="text" id="ofendido-cpf" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="CPF">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-pmam-navy mb-1">Endereço</label>
                                    <input type="text" id="ofendido-endereco" class="input-field w-full p-3 border rounded-lg text-sm" placeholder="Endereço completo">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botões de Navegação -->
                    <div class="flex justify-between mt-10 pt-6 border-t border-pmam-border">
                        <button onclick="sistema.voltarParaTela(1)" class="px-6 py-3 bg-slate-100 text-pmam-navy rounded-lg font-black text-xs uppercase hover:bg-slate-200">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar
                        </button>
                        <button onclick="sistema.avancarParaDocumentos()" class="btn-gold px-10 py-3 rounded-lg font-black text-xs uppercase shadow-xl">
                            Gerar Documentos <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TELA 3: Documentos -->
        <div id="tela-3" class="hidden animate-fadeIn">
            <div class="container mx-auto px-4 py-8">
                <div class="max-w-6xl mx-auto space-y-8">
                    <!-- Documentos Principais -->
                    <div class="bg-white rounded-2xl border-2 border-emerald-100 p-8 shadow-pmam-xl">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center">
                                <i class="fas fa-file-alt text-white text-lg"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-black text-emerald-900 uppercase">Documentos Principais</h3>
                                <p class="text-xs text-emerald-600">Clique em cada documento para visualizar e editar</p>
                            </div>
                        </div>
                        <div id="lista-documentos-basicos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Documentos serão gerados aqui -->
                        </div>
                    </div>
                    
                    <!-- Documentos Diversos -->
                    <div class="bg-white rounded-2xl border-2 border-blue-100 p-8 shadow-pmam-xl">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center">
                                <i class="fas fa-copy text-white text-lg"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-black text-blue-900 uppercase">Documentos Diversos</h3>
                                <p class="text-xs text-blue-600">Adicione ofícios, termos, certidões e outros documentos</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <button onclick="sistema.adicionarOficio()" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-xl border border-blue-200 transition-all flex flex-col items-center justify-center">
                                <i class="fas fa-envelope text-blue-600 text-xl mb-2"></i>
                                <span class="text-xs font-bold text-blue-800 uppercase">Ofício</span>
                            </button>
                            <button onclick="sistema.adicionarTermo()" class="p-4 bg-green-50 hover:bg-green-100 rounded-xl border border-green-200 transition-all flex flex-col items-center justify-center">
                                <i class="fas fa-file-signature text-green-600 text-xl mb-2"></i>
                                <span class="text-xs font-bold text-green-800 uppercase">Termo</span>
                            </button>
                            <button onclick="sistema.adicionarCertidao()" class="p-4 bg-purple-50 hover:bg-purple-100 rounded-xl border border-purple-200 transition-all flex flex-col items-center justify-center">
                                <i class="fas fa-certificate text-purple-600 text-xl mb-2"></i>
                                <span class="text-xs font-bold text-purple-800 uppercase">Certidão</span>
                            </button>
                            <button onclick="sistema.adicionarRelatorio()" class="p-4 bg-amber-50 hover:bg-amber-100 rounded-xl border border-amber-200 transition-all flex flex-col items-center justify-center">
                                <i class="fas fa-chart-bar text-amber-600 text-xl mb-2"></i>
                                <span class="text-xs font-bold text-amber-800 uppercase">Relatório</span>
                            </button>
                        </div>
                        
                        <div id="lista-documentos-diversos" class="space-y-4">
                            <!-- Documentos diversos serão adicionados aqui -->
                        </div>
                    </div>
                    
                    <!-- Botões de Ação -->
                    <div class="flex justify-center gap-6 py-8">
                        <button onclick="sistema.salvarNoBanco()" class="px-8 py-4 bg-pmam-success text-white rounded-xl font-black text-xs uppercase tracking-widest shadow-xl hover:scale-105 transition-all flex items-center gap-3">
                            <i class="fas fa-cloud-upload-alt"></i> Salvar no Banco
                        </button>
                        <button onclick="sistema.visualizarTodos()" class="px-8 py-4 bg-pmam-navy text-white rounded-xl font-black text-xs uppercase tracking-widest shadow-xl hover:scale-105 transition-all flex items-center gap-3">
                            <i class="fas fa-eye"></i> Revisão Final
                        </button>
                        <button onclick="sistema.exportarTodosPDF()" class="btn-gold px-8 py-4 rounded-xl font-black text-xs uppercase tracking-widest shadow-xl hover:scale-105 transition-all flex items-center gap-3">
                            <i class="fas fa-file-pdf"></i> Exportar PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Edição de Documentos -->
    <div id="modal-documento" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4 animate-fadeIn">
        <div class="bg-white rounded-2xl w-full max-w-5xl max-h-[90vh] flex flex-col shadow-2xl border-t-8 border-pmam-gold">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 id="modal-titulo" class="text-xl font-black text-pmam-navy uppercase"></h3>
                <button onclick="sistema.fecharModal()" class="p-2 hover:bg-slate-100 rounded-lg">
                    <i class="fas fa-times text-2xl text-slate-400"></i>
                </button>
            </div>
            <div class="flex-1 overflow-auto p-8 custom-scrollbar bg-slate-50">
                <div id="modal-conteudo"></div>
            </div>
            <div class="p-6 border-t flex justify-end gap-3">
                <button onclick="sistema.fecharModal()" class="px-6 py-3 font-bold text-xs uppercase text-pmam-muted hover:text-pmam-navy">
                    Cancelar
                </button>
                <button onclick="sistema.salvarDocumento()" class="btn-gold px-8 py-3 rounded-lg font-black text-xs uppercase shadow-lg">
                    Salvar Alterações
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Gerenciador de Procedimentos -->
    <div id="modal-gerenciador" class="fixed inset-0 bg-black/90 backdrop-blur-md z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full max-w-6xl h-[80vh] flex flex-col shadow-2xl overflow-hidden">
            <div class="p-8 bg-pmam-navy text-white flex items-center justify-between">
                <div>
                    <h3 class="text-2xl font-black uppercase tracking-tighter">Banco de Procedimentos</h3>
                    <p class="text-[10px] text-pmam-gold uppercase font-bold tracking-widest mt-1">Sincronização em tempo real</p>
                </div>
                <button onclick="sistema.fecharGerenciador()" class="p-2 hover:bg-white/10 rounded-lg">
                    <i class="fas fa-times text-3xl"></i>
                </button>
            </div>
            <div class="p-6 border-b bg-slate-50">
                <div class="flex gap-4">
                    <input type="text" id="busca-procedimento" class="flex-1 p-4 border rounded-2xl shadow-inner focus:ring-4 focus:ring-pmam-gold/20 outline-none text-sm font-bold" placeholder="Pesquisar por nº de portaria, nome ou unidade...">
                    <select id="filtro-status" class="p-4 border rounded-2xl text-sm font-bold">
                        <option value="">Todos os Status</option>
                        <option value="ativo">Ativo</option>
                        <option value="concluido">Concluído</option>
                        <option value="arquivado">Arquivado</option>
                    </select>
                </div>
            </div>
            <div id="lista-procedimentos-salvos" class="flex-1 overflow-auto p-8 custom-scrollbar">
                <!-- Procedimentos carregados do banco aparecerão aqui -->
            </div>
        </div>
    </div>

    <!-- Container para Notificações -->
    <div id="toast-container" class="fixed bottom-10 right-10 z-[100] space-y-3"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;

        class SistemaSISPRO {
            constructor() {
                this.supabase = null;
                this.telaAtual = 1;
                this.procedimentoSelecionado = null;
                this.dadosCaracterizacao = null;
                this.documentos = {
                    basicos: [],
                    diversos: []
                };
                this.documentoAtualAtivo = null;
                this.tipoDocumentoAtual = null;
                this.procedimentoId = null; // ID do procedimento no banco
                this.init();
            }

            init() {
                this.conectarSupabase();
                this.preencherDataAtual();
                this.inicializarEventos();
            }

            conectarSupabase() {
                this.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                this.notificar("Conectado ao Supabase", "success");
            }

            preencherDataAtual() {
                const hoje = new Date();
                document.getElementById('data-dia').value = hoje.getDate();
                document.getElementById('data-mes').value = this.getMesNome(hoje.getMonth());
                document.getElementById('data-ano').value = hoje.getFullYear();
            }

            getMesNome(index) {
                const meses = ['JANEIRO', 'FEVEREIRO', 'MARÇO', 'ABRIL', 'MAIO', 'JUNHO', 'JULHO', 'AGOSTO', 'SETEMBRO', 'OUTUBRO', 'NOVEMBRO', 'DEZEMBRO'];
                return meses[index];
            }

            inicializarEventos() {
                // Toggle sidebar mobile
                document.getElementById('sidebar-toggle').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.toggle('open');
                });

                // Fechar sidebar ao clicar fora (mobile)
                document.addEventListener('click', (e) => {
                    const sidebar = document.getElementById('sidebar');
                    const toggle = document.getElementById('sidebar-toggle');
                    if (!sidebar.contains(e.target) && !toggle.contains(e.target) && window.innerWidth < 1024) {
                        sidebar.classList.remove('open');
                    }
                });

                // Evento de busca no gerenciador
                document.getElementById('busca-procedimento')?.addEventListener('input', (e) => {
                    this.buscarProcedimentos(e.target.value);
                });

                document.getElementById('filtro-status')?.addEventListener('change', (e) => {
                    this.buscarProcedimentos(document.getElementById('busca-procedimento').value, e.target.value);
                });
            }

            selecionarProcedimento(tipo) {
                const lista = {
                    'SAD': { nome: 'SAD', desc: 'Sindicância Administrativa Disciplinar', icon: 'fa-gavel' },
                    'IPM': { nome: 'IPM', desc: 'Inquérito Policial Militar', icon: 'fa-shield-alt' },
                    'SINDINVEST': { nome: 'SINDINVEST', desc: 'Sindicância Investigativa', icon: 'fa-search' }
                };
                
                this.procedimentoSelecionado = lista[tipo];
                document.getElementById('procedimento-nome').textContent = lista[tipo].nome;
                document.getElementById('procedimento-descricao').textContent = lista[tipo].desc;
                document.getElementById('procedimento-icon').querySelector('i').className = `fas ${lista[tipo].icon} text-pmam-gold text-2xl`;
                document.getElementById('procedimento-selecionado-info').classList.remove('hidden');
                document.getElementById('step-1-info').textContent = lista[tipo].nome;
                
                this.notificar(`Procedimento ${lista[tipo].nome} selecionado`, "success");
            }

            avancarParaCaracterizacao() {
                if (!this.procedimentoSelecionado) {
                    this.notificar("Selecione um tipo de procedimento primeiro", "error");
                    return;
                }

                this.telaAtual = 2;
                document.getElementById('tela-1').classList.add('hidden');
                document.getElementById('tela-2').classList.remove('hidden');
                
                // Atualizar barra de progresso
                document.getElementById('step-indicator-1').classList.add('completed');
                document.getElementById('step-indicator-2').classList.add('active');
                document.getElementById('step-indicator-2').classList.remove('completed');
                
                this.notificar("Preencha os dados de caracterização", "info");
            }

            avancarParaDocumentos() {
                // Validar dados obrigatórios
                const portaria = document.getElementById('numero-portaria').value;
                const objeto = document.getElementById('objeto-apuracao').value;
                
                if (!portaria || !objeto) {
                    this.notificar("Preencha os campos obrigatórios (Portaria e Objeto)", "error");
                    return;
                }

                // Salvar dados de caracterização
                this.dadosCaracterizacao = {
                    tipo: this.procedimentoSelecionado.nome,
                    portaria: portaria,
                    data: `${document.getElementById('data-dia').value} de ${document.getElementById('data-mes').value} de ${document.getElementById('data-ano').value}`,
                    unidade: document.getElementById('local-unidade').value,
                    objeto: objeto,
                    status: document.getElementById('status-procedimento').value,
                    encarregado: {
                        posto: document.getElementById('encarregado-posto').value,
                        nome: document.getElementById('encarregado-nome').value,
                        ci: document.getElementById('encarregado-ci').value,
                        unidade: document.getElementById('encarregado-unidade').value
                    },
                    escrivao: {
                        posto: document.getElementById('escrivao-posto').value,
                        nome: document.getElementById('escrivao-nome').value,
                        ci: document.getElementById('escrivao-ci').value
                    },
                    indicado: {
                        posto: document.getElementById('indicado-posto').value,
                        nome: document.getElementById('indicado-nome').value,
                        ci: document.getElementById('indicado-ci').value,
                        unidade: document.getElementById('indicado-unidade').value
                    },
                    ofendido: {
                        nome: document.getElementById('ofendido-nome').value,
                        rg: document.getElementById('ofendido-rg').value,
                        cpf: document.getElementById('ofendido-cpf').value,
                        endereco: document.getElementById('ofendido-endereco').value
                    }
                };

                // Avançar para tela 3
                this.telaAtual = 3;
                document.getElementById('tela-2').classList.add('hidden');
                document.getElementById('tela-3').classList.remove('hidden');
                
                // Atualizar barra de progresso
                document.getElementById('step-indicator-2').classList.add('completed');
                document.getElementById('step-indicator-3').classList.add('active');
                
                // Gerar documentos básicos automaticamente
                this.gerarDocumentosBasicos();
                this.notificar("Documentos básicos gerados automaticamente", "success");
            }

            voltarParaTela(n) {
                document.getElementById(`tela-${this.telaAtual}`).classList.add('hidden');
                document.getElementById(`tela-${n}`).classList.remove('hidden');
                this.telaAtual = n;
                
                // Atualizar barra de progresso
                document.querySelectorAll('.step-item').forEach(item => {
                    item.classList.remove('active', 'completed');
                });
                
                if (n === 1) {
                    document.getElementById('step-indicator-1').classList.add('active');
                } else if (n === 2) {
                    document.getElementById('step-indicator-1').classList.add('completed');
                    document.getElementById('step-indicator-2').classList.add('active');
                }
            }

            notificar(msg, tipo) {
                const toast = document.createElement('div');
                const cores = { 
                    success: 'bg-emerald-600', 
                    error: 'bg-red-600', 
                    warning: 'bg-amber-500',
                    info: 'bg-blue-600'
                };
                const icones = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-triangle',
                    warning: 'fa-exclamation-circle',
                    info: 'fa-info-circle'
                };
                
                toast.className = `${cores[tipo]} text-white px-6 py-4 rounded-2xl shadow-2xl font-black text-xs uppercase tracking-widest animate-slide-in flex items-center gap-3`;
                toast.innerHTML = `<i class="fas ${icones[tipo]}"></i> ${msg}`;
                document.getElementById('toast-container').appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            gerarDocumentosBasicos() {
                const docsBasicos = [
                    { id: 'autuacao', titulo: 'AUTUAÇÃO', icon: 'fa-file-contract', tipo: 'basico' },
                    { id: 'abertura', titulo: 'TERMO DE ABERTURA', icon: 'fa-door-open', tipo: 'basico' },
                    { id: 'designacao', titulo: 'DESIGNAÇÃO DO ESCRIVÃO', icon: 'fa-user-pen', tipo: 'basico' },
                    { id: 'compromisso', titulo: 'TERMO DE COMPROMISSO', icon: 'fa-handshake', tipo: 'basico' },
                    { id: 'conclusao', titulo: 'CONCLUSÃO DOS AUTOS', icon: 'fa-flag-checkered', tipo: 'basico' },
                    { id: 'despacho', titulo: 'DESPACHO INICIAL', icon: 'fa-gavel', tipo: 'basico' }
                ];

                const container = document.getElementById('lista-documentos-basicos');
                container.innerHTML = '';
                
                docsBasicos.forEach(doc => {
                    const conteudo = this.gerarConteudoDocumento(doc.id);
                    this.documentos.basicos.push({
                        id: doc.id,
                        titulo: doc.titulo,
                        conteudo: conteudo,
                        tipo: doc.tipo
                    });
                    
                    const card = document.createElement('div');
                    card.className = "doc-card rounded-xl p-6 bg-white text-center shadow-sm border-2 border-slate-100 hover:border-pmam-gold transition-all cursor-pointer";
                    card.innerHTML = `
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <i class="fas ${doc.icon} text-white text-2xl"></i>
                        </div>
                        <div class="text-sm font-black uppercase text-pmam-navy mb-2">${doc.titulo}</div>
                        <div class="text-[10px] text-emerald-600 font-bold uppercase tracking-widest">PRONTO PARA EDITAR</div>
                    `;
                    card.onclick = () => this.abrirModal(doc.id, 'basico');
                    container.appendChild(card);
                });

                // Atualizar sidebar
                this.atualizarSidebar();
            }

            gerarConteudoDocumento(tipo) {
                const dados = this.dadosCaracterizacao;
                let conteudo = '';
                
                switch(tipo) {
                    case 'autuacao':
                        conteudo = `INQUÉRITO POLICIAL MILITAR\n\n`;
                        conteudo += `ENCARREGADO: ${dados.encarregado.posto} ${dados.encarregado.nome} (CI ${dados.encarregado.ci})\n`;
                        conteudo += `INDICIADO: ${dados.indicado.posto} ${dados.indicado.nome} (CI ${dados.indicado.ci})\n`;
                        conteudo += `OFENDIDO: ${dados.ofendido.nome}\n\n`;
                        conteudo += `Aos ${dados.data.split(' de ')[0]} dias do mês de ${dados.data.split(' de ')[1]} de ${dados.data.split(' de ')[2]}, nesta Cidade de Manaus, Estado do Amazonas, na ${dados.unidade}, autuo a Portaria nº ${dados.portaria}, e demais documentos que a este junto, do que para constar lavro o presente termo. Eu, ${dados.escrivao.posto} ${dados.escrivao.nome} (${dados.escrivao.ci}), o digitei e subscrevo.\n\n`;
                        conteudo += `${dados.encarregado.posto} ${dados.encarregado.nome}\n`;
                        conteudo += `Encarregado`;
                        break;
                        
                    case 'compromisso':
                        conteudo = `TERMO DE COMPROMISSO DO ESCRIVÃO\n\n`;
                        conteudo += `Aos ${dados.data.split(' de ')[0]} dias do mês de ${dados.data.split(' de ')[1]} de ${dados.data.split(' de ')[2]}, nesta Cidade de Manaus, Estado do Amazonas, na ${dados.unidade}, foi designado pelo Senhor ${dados.encarregado.posto} ${dados.encarregado.nome}, Encarregado deste ${dados.tipo}, o ${dados.escrivao.posto} ${dados.escrivao.nome} (CI nº ${dados.escrivao.ci}), para exercer a função de Escrivão, que perante o referido Encarregado prestou compromisso legal de manter o sigilo e cumprir fielmente as determinações legais, durante o exercício da função.\n\n`;
                        conteudo += `${dados.encarregado.posto} ${dados.encarregado.nome}\n`;
                        conteudo += `Encarregado\n\n`;
                        conteudo += `${dados.escrivao.posto} ${dados.escrivao.nome}\n`;
                        conteudo += `Escrivão`;
                        break;
                        
                    case 'despacho':
                        conteudo = `DESPACHO INICIAL\n\n`;
                        conteudo += `Determino ao Senhor Escrivão que adote as seguintes providências:\n\n`;
                        conteudo += `1. Oficiar ao Exmo. Sr. Comandante da unidade, informando-lhe a designação de escrivão, para que seja publicado em BG/BI;\n`;
                        conteudo += `2. Oficiar Ao Ilustríssimo Senhor Diretor da Diretoria de Pessoal da Ativa (DPA) da PMAM, e solicitar o envio de cópia das Fichas de Cadastro e histórico de elogios e punições do ${dados.indicado.posto} ${dados.indicado.nome} (${dados.indicado.ci});\n`;
                        conteudo += `3. Oficiar ao Ilustríssimo Senhor Comandante da unidade do indiciado, e solicitar sua apresentação para ser ouvido;\n`;
                        conteudo += `4. Expeçam-se as requisições de exames periciais necessários.\n\n`;
                        conteudo += `Quartel em Manaus-AM, ${dados.data}.\n\n`;
                        conteudo += `${dados.encarregado.posto} ${dados.encarregado.nome}\n`;
                        conteudo += `Encarregado`;
                        break;
                        
                    default:
                        conteudo = `${tipo.toUpperCase()}\n\n`;
                        conteudo += `PROCEDIMENTO: ${dados.tipo}\n`;
                        conteudo += `PORTARIA: ${dados.portaria}\n`;
                        conteudo += `DATA: ${dados.data}\n`;
                        conteudo += `UNIDADE: ${dados.unidade}\n`;
                        conteudo += `OBJETO: ${dados.objeto}\n\n`;
                        conteudo += `Conteúdo do documento será gerado aqui...`;
                }
                
                return conteudo;
            }

            adicionarOficio() {
                const id = `oficio_${Date.now()}`;
                const titulo = `OFÍCIO ${this.documentos.diversos.filter(d => d.tipo === 'oficio').length + 1}`;
                
                const conteudo = `OFÍCIO\n\n`;
                conteudo += `Ao Ilustríssimo Senhor\n`;
                conteudo += `[DESTINATÁRIO]\n`;
                conteudo += `[CARGO/DESTINAÇÃO]\n\n`;
                conteudo += `Assunto: [ASSUNTO DO OFÍCIO]\n`;
                conteudo += `Referência: Portaria nº ${this.dadosCaracterizacao?.portaria || 'Nº'}\n\n`;
                conteudo += `Senhor(a) [TRATAMENTO],\n\n`;
                conteudo += `1. [TEXTO DO OFÍCIO]\n\n`;
                conteudo += `Respeitosamente,\n\n`;
                conteudo += `${this.dadosCaracterizacao?.encarregado?.posto || ''} ${this.dadosCaracterizacao?.encarregado?.nome || ''}\n`;
                conteudo += `Encarregado`;
                
                this.documentos.diversos.push({
                    id: id,
                    titulo: titulo,
                    conteudo: conteudo,
                    tipo: 'oficio'
                });
                
                this.renderizarDocumentoDiverso(id, titulo, 'oficio');
                this.notificar("Ofício adicionado", "success");
            }

            adicionarTermo() {
                const id = `termo_${Date.now()}`;
                const titulo = `TERMO ${this.documentos.diversos.filter(d => d.tipo === 'termo').length + 1}`;
                
                const conteudo = `TERMO DE DECLARAÇÃO\n\n`;
                conteudo += `Aos [XX] dias do mês de [MÊS] de [ANO], nesta cidade de [CIDADE], no [LOCAL], na presença do ${this.dadosCaracterizacao?.encarregado?.posto || ''} ${this.dadosCaracterizacao?.encarregado?.nome || ''}, autoridade encarregada deste procedimento, comigo ${this.dadosCaracterizacao?.escrivao?.posto || ''} ${this.dadosCaracterizacao?.escrivao?.nome || ''}, escrivão, compareceu o declarante, abaixo qualificado:\n\n`;
                conteudo += `Nome: [NOME COMPLETO]\n`;
                conteudo += `RG: [NÚMERO DO RG]\n`;
                conteudo += `CPF: [NÚMERO DO CPF]\n`;
                conteudo += `Posto/Graduação: [POSTO/GRADUAÇÃO]\n`;
                conteudo += `Unidade: [UNIDADE]\n`;
                conteudo += `Idade: [IDADE]\n`;
                conteudo += `Naturalidade: [CIDADE/ESTADO]\n`;
                conteudo += `Filiação: [NOME DO PAI] e [NOME DA MÃE]\n`;
                conteudo += `Estado civil: [ESTADO CIVIL]\n`;
                conteudo += `Profissão: [PROFISSÃO]\n`;
                conteudo += `Endereço residencial: [ENDEREÇO COMPLETO]\n`;
                conteudo += `Horário - início: [HH:MM] - término: [HH:MM]\n\n`;
                conteudo += `Perguntado sobre os fatos originadores deste feito, respondeu que [RESPOSTA]...\n\n`;
                conteudo += `Nada mais disse e nem lhe foi perguntado. Lido o termo e achado conforme suas declarações, assina, abaixo, juntamente com a autoridade e o escrivão.\n\n`;
                conteudo += `_________________________________\n`;
                conteudo += `${this.dadosCaracterizacao?.encarregado?.posto || ''} ${this.dadosCaracterizacao?.encarregado?.nome || ''}\n`;
                conteudo += `Encarregado\n\n`;
                conteudo += `_________________________________\n`;
                conteudo += `[NOME DO DECLARANTE]\n`;
                conteudo += `Declarante\n\n`;
                conteudo += `_________________________________\n`;
                conteudo += `${this.dadosCaracterizacao?.escrivao?.posto || ''} ${this.dadosCaracterizacao?.escrivao?.nome || ''}\n`;
                conteudo += `Escrivão`;
                
                this.documentos.diversos.push({
                    id: id,
                    titulo: titulo,
                    conteudo: conteudo,
                    tipo: 'termo'
                });
                
                this.renderizarDocumentoDiverso(id, titulo, 'termo');
                this.notificar("Termo adicionado", "success");
            }

            adicionarCertidao() {
                const id = `certidao_${Date.now()}`;
                const titulo = `CERTIDÃO ${this.documentos.diversos.filter(d => d.tipo === 'certidao').length + 1}`;
                
                const conteudo = `CERTIDÃO\n\n`;
                conteudo += `Certifico que foram providenciadas as determinações constantes no despacho do Senhor Encarregado do procedimento.\n\n`;
                conteudo += `Quartel em Manaus-AM, [DATA].\n\n`;
                conteudo += `_________________________________\n`;
                conteudo += `${this.dadosCaracterizacao?.escrivao?.posto || ''} ${this.dadosCaracterizacao?.escrivao?.nome || ''}\n`;
                conteudo += `Escrivão`;
                
                this.documentos.diversos.push({
                    id: id,
                    titulo: titulo,
                    conteudo: conteudo,
                    tipo: 'certidao'
                });
                
                this.renderizarDocumentoDiverso(id, titulo, 'certidao');
                this.notificar("Certidão adicionada", "success");
            }

            adicionarRelatorio() {
                const id = `relatorio_${Date.now()}`;
                const titulo = `RELATÓRIO FINAL`;
                
                const conteudo = `RELATÓRIO DO ${this.dadosCaracterizacao?.tipo || 'PROCEDIMENTO'}\n\n`;
                conteudo += `REFERÊNCIA: Portaria nº ${this.dadosCaracterizacao?.portaria || 'Nº'}\n`;
                conteudo += `ENCARREGADO: ${this.dadosCaracterizacao?.encarregado?.posto || ''} ${this.dadosCaracterizacao?.encarregado?.nome || ''} (${this.dadosCaracterizacao?.encarregado?.ci || ''})\n`;
                conteudo += `INVESTIGADO: ${this.dadosCaracterizacao?.indicado?.posto || ''} ${this.dadosCaracterizacao?.indicado?.nome || ''} (${this.dadosCaracterizacao?.indicado?.ci || ''})\n`;
                conteudo += `OBJETO: ${this.dadosCaracterizacao?.objeto || ''}\n\n`;
                conteudo += `I - INFORMAÇÕES PRELIMINARES\n\n`;
                conteudo += `1. O presente ${this.dadosCaracterizacao?.tipo || 'procedimento'} foi instaurado por determinação superior por meio da portaria em referência, com a finalidade de ${this.dadosCaracterizacao?.objeto || 'apurar os fatos'}.\n\n`;
                conteudo += `II - DILIGÊNCIAS REALIZADAS\n\n`;
                conteudo += `1. Durante a instrução deste procedimento, foram realizadas as seguintes diligências: [DESCREVA AS DILIGÊNCIAS]\n\n`;
                conteudo += `III - CONCLUSÃO\n\n`;
                conteudo += `1. Por todo o exposto, conclui-se que [CONCLUSÃO DO ENCARREGADO].\n\n`;
                conteudo += `Quartel em Manaus-AM, [DATA].\n\n`;
                conteudo += `_________________________________\n`;
                conteudo += `${this.dadosCaracterizacao?.encarregado?.posto || ''} ${this.dadosCaracterizacao?.encarregado?.nome || ''}\n`;
                conteudo += `Encarregado`;
                
                this.documentos.diversos.push({
                    id: id,
                    titulo: titulo,
                    conteudo: conteudo,
                    tipo: 'relatorio'
                });
                
                this.renderizarDocumentoDiverso(id, titulo, 'relatorio');
                this.notificar("Relatório adicionado", "success");
            }

            renderizarDocumentoDiverso(id, titulo, tipo) {
                const container = document.getElementById('lista-documentos-diversos');
                const cores = {
                    oficio: 'blue',
                    termo: 'green',
                    certidao: 'purple',
                    relatorio: 'amber'
                };
                const icones = {
                    oficio: 'fa-envelope',
                    termo: 'fa-file-signature',
                    certidao: 'fa-certificate',
                    relatorio: 'fa-chart-bar'
                };
                
                const docDiv = document.createElement('div');
                docDiv.className = `p-4 bg-${cores[tipo]}-50 rounded-xl border border-${cores[tipo]}-200 flex items-center justify-between hover:bg-${cores[tipo]}-100 transition-all`;
                docDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-${cores[tipo]}-500 flex items-center justify-center">
                            <i class="fas ${icones[tipo]} text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm font-bold text-${cores[tipo]}-800">${titulo}</div>
                            <div class="text-xs text-${cores[tipo]}-600 uppercase">${tipo}</div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="sistema.editarDocumentoDiverso('${id}')" class="p-2 bg-white border border-${cores[tipo]}-200 rounded-lg hover:bg-${cores[tipo]}-50">
                            <i class="fas fa-edit text-${cores[tipo]}-600"></i>
                        </button>
                        <button onclick="sistema.removerDocumentoDiverso('${id}')" class="p-2 bg-white border border-red-200 rounded-lg hover:bg-red-50">
                            <i class="fas fa-trash text-red-600"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(docDiv);
                this.atualizarSidebar();
            }

            editarDocumentoDiverso(id) {
                const doc = this.documentos.diversos.find(d => d.id === id);
                if (doc) {
                    this.abrirModal(id, 'diverso');
                }
            }

            removerDocumentoDiverso(id) {
                this.documentos.diversos = this.documentos.diversos.filter(d => d.id !== id);
                this.atualizarSidebar();
                this.notificar("Documento removido", "warning");
                this.carregarListaDocumentosDiversos();
            }

            carregarListaDocumentosDiversos() {
                const container = document.getElementById('lista-documentos-diversos');
                container.innerHTML = '';
                
                this.documentos.diversos.forEach(doc => {
                    this.renderizarDocumentoDiverso(doc.id, doc.titulo, doc.tipo);
                });
            }

            abrirModal(id, tipo) {
                let doc;
                if (tipo === 'basico') {
                    doc = this.documentos.basicos.find(d => d.id === id);
                } else {
                    doc = this.documentos.diversos.find(d => d.id === id);
                }
                
                if (!doc) return;
                
                this.documentoAtualAtivo = id;
                this.tipoDocumentoAtual = tipo;
                
                document.getElementById('modal-titulo').textContent = doc.titulo;
                document.getElementById('modal-conteudo').innerHTML = `
                    <textarea id="edit-area" class="w-full h-[500px] p-6 font-mono text-sm border border-slate-300 rounded-lg bg-white focus:ring-2 focus:ring-pmam-gold focus:border-transparent outline-none resize-none">${doc.conteudo}</textarea>
                `;
                document.getElementById('modal-documento').classList.remove('hidden');
            }

            fecharModal() {
                document.getElementById('modal-documento').classList.add('hidden');
                this.documentoAtualAtivo = null;
                this.tipoDocumentoAtual = null;
            }

            salvarDocumento() {
                const novoConteudo = document.getElementById('edit-area').value;
                
                if (this.tipoDocumentoAtual === 'basico') {
                    const doc = this.documentos.basicos.find(d => d.id === this.documentoAtualAtivo);
                    if (doc) doc.conteudo = novoConteudo;
                } else {
                    const doc = this.documentos.diversos.find(d => d.id === this.documentoAtualAtivo);
                    if (doc) doc.conteudo = novoConteudo;
                }
                
                this.fecharModal();
                this.notificar("Alterações salvas", "success");
            }

            atualizarSidebar() {
                const totalDocs = this.documentos.basicos.length + this.documentos.diversos.length;
                document.getElementById('step-3-info').textContent = `${totalDocs} Documentos`;
                
                const listaSidebar = document.getElementById('lista-documentos-sidebar');
                listaSidebar.innerHTML = '';
                
                this.documentos.basicos.forEach(doc => {
                    const item = document.createElement('div');
                    item.className = 'text-xs text-pmam-navy p-2 bg-slate-50 rounded-lg mb-1';
                    item.textContent = `✓ ${doc.titulo}`;
                    listaSidebar.appendChild(item);
                });
                
                this.documentos.diversos.forEach(doc => {
                    const item = document.createElement('div');
                    item.className = 'text-xs text-pmam-muted p-2 bg-slate-50 rounded-lg mb-1';
                    item.textContent = `• ${doc.titulo}`;
                    listaSidebar.appendChild(item);
                });
            }

            async salvarNoBanco() {
                if (!this.dadosCaracterizacao) {
                    this.notificar("Nenhum dado para salvar", "error");
                    return;
                }

                try {
                    this.notificar("Salvando no banco de dados...", "info");
                    
                    const procedimentoData = {
                        tipo_procedimento: this.dadosCaracterizacao.tipo,
                        numero_portaria: this.dadosCaracterizacao.portaria,
                        data_portaria: this.dadosCaracterizacao.data,
                        unidade: this.dadosCaracterizacao.unidade,
                        objeto_apuracao: this.dadosCaracterizacao.objeto,
                        status: this.dadosCaracterizacao.status,
                        dados_envolvidos: {
                            encarregado: this.dadosCaracterizacao.encarregado,
                            escrivao: this.dadosCaracterizacao.escrivao,
                            indicado: this.dadosCaracterizacao.indicado,
                            ofendido: this.dadosCaracterizacao.ofendido
                        },
                        documentos: {
                            basicos: this.documentos.basicos,
                            diversos: this.documentos.diversos
                        },
                        data_criacao: new Date().toISOString(),
                        data_atualizacao: new Date().toISOString()
                    };

                    let result;
                    if (this.procedimentoId) {
                        // Atualizar procedimento existente
                        result = await this.supabase
                            .from('procedimentos')
                            .update(procedimentoData)
                            .eq('id', this.procedimentoId);
                    } else {
                        // Criar novo procedimento
                        result = await this.supabase
                            .from('procedimentos')
                            .insert([procedimentoData])
                            .select();
                            
                        if (result.data && result.data.length > 0) {
                            this.procedimentoId = result.data[0].id;
                        }
                    }

                    if (result.error) {
                        throw new Error(result.error.message);
                    }

                    this.notificar("Procedimento salvo no banco com sucesso!", "success");
                } catch (error) {
                    console.error("Erro ao salvar no banco:", error);
                    this.notificar(`Erro ao salvar: ${error.message}`, "error");
                }
            }

            async abrirGerenciador() {
                document.getElementById('modal-gerenciador').classList.remove('hidden');
                await this.carregarProcedimentos();
            }

            fecharGerenciador() {
                document.getElementById('modal-gerenciador').classList.add('hidden');
            }

            async carregarProcedimentos() {
                try {
                    const { data, error } = await this.supabase
                        .from('procedimentos')
                        .select('*')
                        .order('data_criacao', { ascending: false });

                    if (error) throw error;

                    this.exibirProcedimentos(data);
                } catch (error) {
                    console.error("Erro ao carregar procedimentos:", error);
                    document.getElementById('lista-procedimentos-salvos').innerHTML = `
                        <div class="text-center p-8 text-red-600">
                            <i class="fas fa-exclamation-triangle text-3xl mb-4"></i>
                            <p>Erro ao carregar procedimentos</p>
                        </div>
                    `;
                }
            }

            async buscarProcedimentos(termo = '', status = '') {
                try {
                    let query = this.supabase
                        .from('procedimentos')
                        .select('*');

                    if (termo) {
                        query = query.or(`numero_portaria.ilike.%${termo}%,unidade.ilike.%${termo}%,dados_envolvidos->encarregado->nome.ilike.%${termo}%`);
                    }

                    if (status) {
                        query = query.eq('status', status);
                    }

                    query = query.order('data_criacao', { ascending: false });

                    const { data, error } = await query;

                    if (error) throw error;

                    this.exibirProcedimentos(data);
                } catch (error) {
                    console.error("Erro na busca:", error);
                }
            }

            exibirProcedimentos(procedimentos) {
                const container = document.getElementById('lista-procedimentos-salvos');
                
                if (!procedimentos || procedimentos.length === 0) {
                    container.innerHTML = `
                        <div class="text-center p-8 text-pmam-muted">
                            <i class="fas fa-folder-open text-3xl mb-4"></i>
                            <p>Nenhum procedimento encontrado</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = procedimentos.map(proc => {
                    const statusClass = `status-${proc.status || 'ativo'}`;
                    const statusText = (proc.status || 'ativo').toUpperCase();
                    
                    return `
                        <div class="bg-white rounded-2xl p-6 mb-4 shadow-pmam-lg border border-pmam-border hover:border-pmam-gold transition-all cursor-pointer" onclick="sistema.carregarProcedimento('${proc.id}')">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-xs font-black bg-pmam-navy text-white px-3 py-1 rounded-full uppercase">${proc.tipo_procedimento}</span>
                                        <span class="status-badge ${statusClass}">${statusText}</span>
                                    </div>
                                    <h4 class="text-lg font-black text-pmam-navy">${proc.numero_portaria}</h4>
                                    <p class="text-sm text-pmam-muted mt-1">${proc.objeto_apuracao?.substring(0, 100)}${proc.objeto_apuracao?.length > 100 ? '...' : ''}</p>
                                </div>
                                <i class="fas fa-chevron-right text-pmam-gold text-xl"></i>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-xs">
                                <div>
                                    <span class="font-bold text-pmam-navy">Unidade:</span>
                                    <span class="text-pmam-muted ml-2">${proc.unidade}</span>
                                </div>
                                <div>
                                    <span class="font-bold text-pmam-navy">Data:</span>
                                    <span class="text-pmam-muted ml-2">${proc.data_portaria}</span>
                                </div>
                                <div>
                                    <span class="font-bold text-pmam-navy">Encarregado:</span>
                                    <span class="text-pmam-muted ml-2">${proc.dados_envolvidos?.encarregado?.posto || ''} ${proc.dados_envolvidos?.encarregado?.nome || ''}</span>
                                </div>
                                <div>
                                    <span class="font-bold text-pmam-navy">Criado em:</span>
                                    <span class="text-pmam-muted ml-2">${new Date(proc.data_criacao).toLocaleDateString('pt-BR')}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async carregarProcedimento(id) {
                try {
                    this.notificar("Carregando procedimento...", "info");
                    
                    const { data, error } = await this.supabase
                        .from('procedimentos')
                        .select('*')
                        .eq('id', id)
                        .single();

                    if (error) throw error;

                    this.procedimentoId = data.id;
                    
                    // Carregar dados do procedimento
                    this.procedimentoSelecionado = {
                        nome: data.tipo_procedimento,
                        desc: data.tipo_procedimento === 'SAD' ? 'Sindicância Administrativa Disciplinar' : 
                              data.tipo_procedimento === 'IPM' ? 'Inquérito Policial Militar' : 
                              'Sindicância Investigativa',
                        icon: data.tipo_procedimento === 'SAD' ? 'fa-gavel' : 
                              data.tipo_procedimento === 'IPM' ? 'fa-shield-alt' : 
                              'fa-search'
                    };

                    this.dadosCaracterizacao = {
                        tipo: data.tipo_procedimento,
                        portaria: data.numero_portaria,
                        data: data.data_portaria,
                        unidade: data.unidade,
                        objeto: data.objeto_apuracao,
                        status: data.status,
                        encarregado: data.dados_envolvidos?.encarregado || {},
                        escrivao: data.dados_envolvidos?.escrivao || {},
                        indicado: data.dados_envolvidos?.indicado || {},
                        ofendido: data.dados_envolvidos?.ofendido || {}
                    };

                    this.documentos = {
                        basicos: data.documentos?.basicos || [],
                        diversos: data.documentos?.diversos || []
                    };

                    // Preencher interface
                    this.preencherInterfaceComDados();
                    this.fecharGerenciador();
                    this.notificar("Procedimento carregado com sucesso", "success");
                    
                    // Ir para tela 3
                    this.telaAtual = 3;
                    document.getElementById('tela-1').classList.add('hidden');
                    document.getElementById('tela-2').classList.add('hidden');
                    document.getElementById('tela-3').classList.remove('hidden');
                    
                    // Atualizar barra de progresso
                    document.querySelectorAll('.step-item').forEach(item => {
                        item.classList.remove('active', 'completed');
                    });
                    document.getElementById('step-indicator-1').classList.add('completed');
                    document.getElementById('step-indicator-2').classList.add('completed');
                    document.getElementById('step-indicator-3').classList.add('active');
                    
                    // Carregar documentos
                    this.carregarDocumentosNaTela();
                    
                } catch (error) {
                    console.error("Erro ao carregar procedimento:", error);
                    this.notificar(`Erro ao carregar: ${error.message}`, "error");
                }
            }

            preencherInterfaceComDados() {
                // Tela 1
                document.getElementById('procedimento-nome').textContent = this.procedimentoSelecionado.nome;
                document.getElementById('procedimento-descricao').textContent = this.procedimentoSelecionado.desc;
                document.getElementById('procedimento-icon').querySelector('i').className = `fas ${this.procedimentoSelecionado.icon} text-pmam-gold text-2xl`;
                document.getElementById('procedimento-selecionado-info').classList.remove('hidden');
                document.getElementById('step-1-info').textContent = this.procedimentoSelecionado.nome;

                // Tela 2
                document.getElementById('numero-portaria').value = this.dadosCaracterizacao.portaria || '';
                if (this.dadosCaracterizacao.data) {
                    const partes = this.dadosCaracterizacao.data.split(' de ');
                    if (partes.length === 3) {
                        document.getElementById('data-dia').value = partes[0];
                        document.getElementById('data-mes').value = partes[1];
                        document.getElementById('data-ano').value = partes[2];
                    }
                }
                document.getElementById('local-unidade').value = this.dadosCaracterizacao.unidade || '';
                document.getElementById('objeto-apuracao').value = this.dadosCaracterizacao.objeto || '';
                document.getElementById('status-procedimento').value = this.dadosCaracterizacao.status || 'ativo';

                // Dados dos envolvidos
                if (this.dadosCaracterizacao.encarregado) {
                    document.getElementById('encarregado-posto').value = this.dadosCaracterizacao.encarregado.posto || '';
                    document.getElementById('encarregado-nome').value = this.dadosCaracterizacao.encarregado.nome || '';
                    document.getElementById('encarregado-ci').value = this.dadosCaracterizacao.encarregado.ci || '';
                    document.getElementById('encarregado-unidade').value = this.dadosCaracterizacao.encarregado.unidade || '';
                }

                if (this.dadosCaracterizacao.escrivao) {
                    document.getElementById('escrivao-posto').value = this.dadosCaracterizacao.escrivao.posto || '';
                    document.getElementById('escrivao-nome').value = this.dadosCaracterizacao.escrivao.nome || '';
                    document.getElementById('escrivao-ci').value = this.dadosCaracterizacao.escrivao.ci || '';
                }

                if (this.dadosCaracterizacao.indicado) {
                    document.getElementById('indicado-posto').value = this.dadosCaracterizacao.indicado.posto || '';
                    document.getElementById('indicado-nome').value = this.dadosCaracterizacao.indicado.nome || '';
                    document.getElementById('indicado-ci').value = this.dadosCaracterizacao.indicado.ci || '';
                    document.getElementById('indicado-unidade').value = this.dadosCaracterizacao.indicado.unidade || '';
                }

                if (this.dadosCaracterizacao.ofendido) {
                    document.getElementById('ofendido-nome').value = this.dadosCaracterizacao.ofendido.nome || '';
                    document.getElementById('ofendido-rg').value = this.dadosCaracterizacao.ofendido.rg || '';
                    document.getElementById('ofendido-cpf').value = this.dadosCaracterizacao.ofendido.cpf || '';
                    document.getElementById('ofendido-endereco').value = this.dadosCaracterizacao.ofendido.endereco || '';
                }
            }

            carregarDocumentosNaTela() {
                // Documentos básicos
                const containerBasicos = document.getElementById('lista-documentos-basicos');
                containerBasicos.innerHTML = '';
                
                this.documentos.basicos.forEach(doc => {
                    const icon = doc.id === 'autuacao' ? 'fa-file-contract' :
                                 doc.id === 'abertura' ? 'fa-door-open' :
                                 doc.id === 'designacao' ? 'fa-user-pen' :
                                 doc.id === 'compromisso' ? 'fa-handshake' :
                                 doc.id === 'conclusao' ? 'fa-flag-checkered' : 'fa-gavel';
                    
                    const card = document.createElement('div');
                    card.className = "doc-card rounded-xl p-6 bg-white text-center shadow-sm border-2 border-slate-100 hover:border-pmam-gold transition-all cursor-pointer";
                    card.innerHTML = `
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <i class="fas ${icon} text-white text-2xl"></i>
                        </div>
                        <div class="text-sm font-black uppercase text-pmam-navy mb-2">${doc.titulo}</div>
                        <div class="text-[10px] text-emerald-600 font-bold uppercase tracking-widest">CARREGADO</div>
                    `;
                    card.onclick = () => this.abrirModal(doc.id, 'basico');
                    containerBasicos.appendChild(card);
                });

                // Documentos diversos
                this.carregarListaDocumentosDiversos();
                this.atualizarSidebar();
            }

            async carregarDoBanco() {
                await this.abrirGerenciador();
            }

            novoProcedimento() {
                this.procedimentoId = null;
                this.procedimentoSelecionado = null;
                this.dadosCaracterizacao = null;
                this.documentos = { basicos: [], diversos: [] };
                
                // Limpar formulários
                document.querySelectorAll('input, textarea, select').forEach(element => {
                    if (element.id && !element.id.includes('data-')) {
                        element.value = '';
                    }
                });
                
                // Resetar interface
                document.getElementById('procedimento-selecionado-info').classList.add('hidden');
                document.getElementById('lista-documentos-basicos').innerHTML = '';
                document.getElementById('lista-documentos-diversos').innerHTML = '';
                document.getElementById('lista-documentos-sidebar').innerHTML = `
                    <div class="text-xs text-pmam-muted text-center italic">Nenhum documento gerado</div>
                `;
                
                this.telaAtual = 1;
                document.getElementById('tela-2').classList.add('hidden');
                document.getElementById('tela-3').classList.add('hidden');
                document.getElementById('tela-1').classList.remove('hidden');
                
                document.querySelectorAll('.step-item').forEach(item => {
                    item.classList.remove('active', 'completed');
                });
                document.getElementById('step-indicator-1').classList.add('active');
                
                document.getElementById('step-1-info').textContent = 'Não selecionado';
                document.getElementById('step-2-info').textContent = 'Aguardando';
                document.getElementById('step-3-info').textContent = '0 Seções';
                
                this.notificar("Novo procedimento iniciado", "info");
            }

            visualizarTodos() {
                let conteudoCompleto = `SISPRO - PMAM | RELATÓRIO COMPLETO\n\n`;
                conteudoCompleto += `PROCEDIMENTO: ${this.dadosCaracterizacao?.tipo || ''}\n`;
                conteudoCompleto += `PORTARIA: ${this.dadosCaracterizacao?.portaria || ''}\n`;
                conteudoCompleto += `DATA: ${this.dadosCaracterizacao?.data || ''}\n`;
                conteudoCompleto += `UNIDADE: ${this.dadosCaracterizacao?.unidade || ''}\n`;
                conteudoCompleto += `STATUS: ${this.dadosCaracterizacao?.status?.toUpperCase() || ''}\n\n`;
                conteudoCompleto += `========================================\n\n`;
                
                // Documentos básicos
                conteudoCompleto += `DOCUMENTOS PRINCIPAIS:\n\n`;
                this.documentos.basicos.forEach(doc => {
                    conteudoCompleto += `${doc.titulo}\n`;
                    conteudoCompleto += `${doc.conteudo}\n\n`;
                    conteudoCompleto += `----------------------------------------\n\n`;
                });
                
                // Documentos diversos
                if (this.documentos.diversos.length > 0) {
                    conteudoCompleto += `DOCUMENTOS DIVERSOS:\n\n`;
                    this.documentos.diversos.forEach(doc => {
                        conteudoCompleto += `${doc.titulo}\n`;
                        conteudoCompleto += `${doc.conteudo}\n\n`;
                        conteudoCompleto += `----------------------------------------\n\n`;
                    });
                }
                
                // Abrir em nova janela para visualização
                const janela = window.open();
                janela.document.write(`<pre style="font-family: monospace; padding: 20px; white-space: pre-wrap;">${conteudoCompleto}</pre>`);
                janela.document.title = `Visualização - ${this.dadosCaracterizacao?.portaria || 'Documento'}`;
            }

            exportarTodosPDF() {
                if (!this.dadosCaracterizacao) {
                    this.notificar("Nenhum dado para exportar", "error");
                    return;
                }

                const doc = new jsPDF();
                let y = 20;
                let page = 1;
                
                // Cabeçalho
                doc.setFont("helvetica", "bold");
                doc.setFontSize(16);
                doc.text("POLÍCIA MILITAR DO AMAZONAS", 105, y, { align: "center" });
                y += 10;
                doc.setFontSize(14);
                doc.text("SISTEMA DE PROCEDIMENTOS - SISPRO", 105, y, { align: "center" });
                y += 15;
                doc.setFontSize(12);
                doc.text(`PROCEDIMENTO: ${this.dadosCaracterizacao.tipo}`, 20, y);
                y += 7;
                doc.text(`PORTARIA: ${this.dadosCaracterizacao.portaria}`, 20, y);
                y += 7;
                doc.text(`DATA: ${this.dadosCaracterizacao.data}`, 20, y);
                y += 7;
                doc.text(`UNIDADE: ${this.dadosCaracterizacao.unidade}`, 20, y);
                y += 7;
                doc.text(`STATUS: ${this.dadosCaracterizacao.status.toUpperCase()}`, 20, y);
                y += 15;
                
                // Documentos básicos
                doc.setFontSize(14);
                doc.text("DOCUMENTOS PRINCIPAIS", 105, y, { align: "center" });
                y += 10;
                
                this.documentos.basicos.forEach((documento, index) => {
                    if (y > 250) {
                        doc.addPage();
                        y = 20;
                        page++;
                    }
                    
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "bold");
                    doc.text(documento.titulo, 20, y);
                    y += 7;
                    
                    doc.setFontSize(10);
                    doc.setFont("helvetica", "normal");
                    const linhas = doc.splitTextToSize(documento.conteudo, 170);
                    doc.text(linhas, 20, y);
                    y += (linhas.length * 5) + 10;
                });
                
                // Documentos diversos
                if (this.documentos.diversos.length > 0) {
                    if (y > 200) {
                        doc.addPage();
                        y = 20;
                        page++;
                    }
                    
                    doc.setFontSize(14);
                    doc.setFont("helvetica", "bold");
                    doc.text("DOCUMENTOS DIVERSOS", 105, y, { align: "center" });
                    y += 10;
                    
                    this.documentos.diversos.forEach(documento => {
                        if (y > 250) {
                            doc.addPage();
                            y = 20;
                            page++;
                        }
                        
                        doc.setFontSize(12);
                        doc.setFont("helvetica", "bold");
                        doc.text(documento.titulo, 20, y);
                        y += 7;
                        
                        doc.setFontSize(10);
                        doc.setFont("helvetica", "normal");
                        const linhas = doc.splitTextToSize(documento.conteudo, 170);
                        doc.text(linhas, 20, y);
                        y += (linhas.length * 5) + 10;
                    });
                }
                
                // Rodapé
                const totalPaginas = page;
                for (let i = 1; i <= totalPaginas; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setFont("helvetica", "italic");
                    doc.text(`Página ${i} de ${totalPaginas} - SISPRO PMAM`, 105, 287, { align: "center" });
                    doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 105, 292, { align: "center" });
                }
                
                doc.save(`SISPRO_${this.dadosCaracterizacao.portaria.replace(/\//g, '_')}.pdf`);
                this.notificar("PDF exportado com sucesso", "success");
            }
        }

        // Inicializar sistema
        const sistema = new SistemaSISPRO();

        // Expor sistema globalmente para os botões HTML
        window.sistema = sistema;
    </script>
</body>
</html>
